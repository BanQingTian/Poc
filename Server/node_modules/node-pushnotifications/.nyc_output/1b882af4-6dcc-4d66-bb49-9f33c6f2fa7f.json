{"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/index.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/index.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":49}}},"fnMap":{},"branchMap":{},"s":{"0":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["index.js"],"names":["module","exports","require"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiBC,OAAO,CAAC,sBAAD,CAAxB","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["module.exports = require('./push-notifications');\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ac505600b4a8550cb4492158c14fd0374bf2b4ac","contentHash":"43845ff7910f4ff122a9a78c3a0195ebe68f7e7aaebfa92b556880bb35e57f53"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/push-notifications.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/push-notifications.js","statementMap":{"0":{"start":{"line":3,"column":15},"end":{"line":3,"column":59}},"1":{"start":{"line":5,"column":15},"end":{"line":5,"column":59}},"2":{"start":{"line":7,"column":15},"end":{"line":7,"column":59}},"3":{"start":{"line":9,"column":15},"end":{"line":9,"column":59}},"4":{"start":{"line":11,"column":15},"end":{"line":11,"column":59}},"5":{"start":{"line":13,"column":17},"end":{"line":13,"column":39}},"6":{"start":{"line":15,"column":39},"end":{"line":15,"column":93}},"7":{"start":{"line":17,"column":54},"end":{"line":17,"column":73}},"8":{"start":{"line":17,"column":75},"end":{"line":17,"column":326}},"9":{"start":{"line":17,"column":125},"end":{"line":17,"column":161}},"10":{"start":{"line":17,"column":163},"end":{"line":17,"column":292}},"11":{"start":{"line":17,"column":183},"end":{"line":17,"column":292}},"12":{"start":{"line":17,"column":225},"end":{"line":17,"column":288}},"13":{"start":{"line":17,"column":293},"end":{"line":17,"column":324}},"14":{"start":{"line":17,"column":327},"end":{"line":17,"column":339}},"15":{"start":{"line":19,"column":33},"end":{"line":19,"column":517}},"16":{"start":{"line":19,"column":46},"end":{"line":19,"column":47}},"17":{"start":{"line":19,"column":91},"end":{"line":19,"column":131}},"18":{"start":{"line":19,"column":133},"end":{"line":19,"column":515}},"19":{"start":{"line":19,"column":146},"end":{"line":19,"column":247}},"20":{"start":{"line":19,"column":201},"end":{"line":19,"column":243}},"21":{"start":{"line":19,"column":255},"end":{"line":19,"column":515}},"22":{"start":{"line":19,"column":295},"end":{"line":19,"column":369}},"23":{"start":{"line":19,"column":379},"end":{"line":19,"column":513}},"24":{"start":{"line":19,"column":428},"end":{"line":19,"column":509}},"25":{"start":{"line":19,"column":518},"end":{"line":19,"column":532}},"26":{"start":{"line":21,"column":44},"end":{"line":21,"column":195}},"27":{"start":{"line":21,"column":62},"end":{"line":21,"column":166}},"28":{"start":{"line":21,"column":176},"end":{"line":21,"column":193}},"29":{"start":{"line":21,"column":196},"end":{"line":21,"column":207}},"30":{"start":{"line":25,"column":4},"end":{"line":25,"column":29}},"31":{"start":{"line":29,"column":4},"end":{"line":29,"column":77}},"32":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"33":{"start":{"line":32,"column":6},"end":{"line":32,"column":26}},"34":{"start":{"line":35,"column":4},"end":{"line":35,"column":55}},"35":{"start":{"line":39,"column":4},"end":{"line":45,"column":7}},"36":{"start":{"line":40,"column":6},"end":{"line":40,"column":44}},"37":{"start":{"line":40,"column":22},"end":{"line":40,"column":26}},"38":{"start":{"line":41,"column":6},"end":{"line":41,"column":21}},"39":{"start":{"line":43,"column":6},"end":{"line":43,"column":36}},"40":{"start":{"line":43,"column":22},"end":{"line":43,"column":26}},"41":{"start":{"line":44,"column":6},"end":{"line":44,"column":35}},"42":{"start":{"line":49,"column":21},"end":{"line":49,"column":23}},"43":{"start":{"line":50,"column":22},"end":{"line":50,"column":24}},"44":{"start":{"line":51,"column":22},"end":{"line":51,"column":24}},"45":{"start":{"line":52,"column":22},"end":{"line":52,"column":24}},"46":{"start":{"line":53,"column":22},"end":{"line":53,"column":24}},"47":{"start":{"line":54,"column":26},"end":{"line":54,"column":28}},"48":{"start":{"line":55,"column":22},"end":{"line":55,"column":24}},"49":{"start":{"line":56,"column":19},"end":{"line":56,"column":75}},"50":{"start":{"line":58,"column":4},"end":{"line":74,"column":7}},"51":{"start":{"line":59,"column":6},"end":{"line":73,"column":7}},"52":{"start":{"line":60,"column":8},"end":{"line":60,"column":34}},"53":{"start":{"line":61,"column":13},"end":{"line":73,"column":7}},"54":{"start":{"line":62,"column":8},"end":{"line":62,"column":30}},"55":{"start":{"line":63,"column":13},"end":{"line":73,"column":7}},"56":{"start":{"line":64,"column":8},"end":{"line":64,"column":30}},"57":{"start":{"line":65,"column":13},"end":{"line":73,"column":7}},"58":{"start":{"line":66,"column":8},"end":{"line":66,"column":30}},"59":{"start":{"line":67,"column":13},"end":{"line":73,"column":7}},"60":{"start":{"line":68,"column":8},"end":{"line":68,"column":30}},"61":{"start":{"line":69,"column":13},"end":{"line":73,"column":7}},"62":{"start":{"line":70,"column":8},"end":{"line":70,"column":30}},"63":{"start":{"line":72,"column":8},"end":{"line":72,"column":30}},"64":{"start":{"line":76,"column":4},"end":{"line":103,"column":5}},"65":{"start":{"line":78,"column":6},"end":{"line":80,"column":7}},"66":{"start":{"line":79,"column":8},"end":{"line":79,"column":72}},"67":{"start":{"line":83,"column":6},"end":{"line":85,"column":7}},"68":{"start":{"line":84,"column":8},"end":{"line":84,"column":87}},"69":{"start":{"line":88,"column":6},"end":{"line":90,"column":7}},"70":{"start":{"line":89,"column":8},"end":{"line":89,"column":72}},"71":{"start":{"line":93,"column":6},"end":{"line":95,"column":7}},"72":{"start":{"line":94,"column":8},"end":{"line":94,"column":72}},"73":{"start":{"line":98,"column":6},"end":{"line":100,"column":7}},"74":{"start":{"line":99,"column":8},"end":{"line":99,"column":76}},"75":{"start":{"line":102,"column":6},"end":{"line":102,"column":41}},"76":{"start":{"line":106,"column":4},"end":{"line":120,"column":5}},"77":{"start":{"line":107,"column":22},"end":{"line":112,"column":7}},"78":{"start":{"line":113,"column":6},"end":{"line":118,"column":9}},"79":{"start":{"line":114,"column":8},"end":{"line":117,"column":11}},"80":{"start":{"line":119,"column":6},"end":{"line":119,"column":46}},"81":{"start":{"line":123,"column":4},"end":{"line":130,"column":5}},"82":{"start":{"line":124,"column":6},"end":{"line":129,"column":10}},"83":{"start":{"line":132,"column":4},"end":{"line":142,"column":7}},"84":{"start":{"line":133,"column":17},"end":{"line":133,"column":43}},"85":{"start":{"line":133,"column":38},"end":{"line":133,"column":42}},"86":{"start":{"line":135,"column":6},"end":{"line":135,"column":24}},"87":{"start":{"line":136,"column":6},"end":{"line":136,"column":21}},"88":{"start":{"line":138,"column":17},"end":{"line":138,"column":43}},"89":{"start":{"line":138,"column":38},"end":{"line":138,"column":42}},"90":{"start":{"line":140,"column":6},"end":{"line":140,"column":14}},"91":{"start":{"line":141,"column":6},"end":{"line":141,"column":33}},"92":{"start":{"line":147,"column":0},"end":{"line":147,"column":20}}},"fnMap":{"0":{"name":"_interopRequireDefault","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":31}},"loc":{"start":{"line":15,"column":37},"end":{"line":15,"column":95}},"line":15},"1":{"name":"ownKeys","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":16}},"loc":{"start":{"line":17,"column":41},"end":{"line":17,"column":341}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":208},"end":{"line":17,"column":209}},"loc":{"start":{"line":17,"column":223},"end":{"line":17,"column":290}},"line":17},"3":{"name":"_objectSpread","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":22}},"loc":{"start":{"line":19,"column":31},"end":{"line":19,"column":534}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":19,"column":184},"end":{"line":19,"column":185}},"loc":{"start":{"line":19,"column":199},"end":{"line":19,"column":245}},"line":19},"5":{"name":"(anonymous_5)","decl":{"start":{"line":19,"column":411},"end":{"line":19,"column":412}},"loc":{"start":{"line":19,"column":426},"end":{"line":19,"column":511}},"line":19},"6":{"name":"_defineProperty","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":24}},"loc":{"start":{"line":21,"column":42},"end":{"line":21,"column":209}},"line":21},"7":{"name":"(anonymous_7)","decl":{"start":{"line":24,"column":2},"end":{"line":24,"column":3}},"loc":{"start":{"line":24,"column":23},"end":{"line":26,"column":3}},"line":24},"8":{"name":"(anonymous_8)","decl":{"start":{"line":28,"column":2},"end":{"line":28,"column":3}},"loc":{"start":{"line":28,"column":19},"end":{"line":36,"column":3}},"line":28},"9":{"name":"(anonymous_9)","decl":{"start":{"line":38,"column":2},"end":{"line":38,"column":3}},"loc":{"start":{"line":38,"column":37},"end":{"line":46,"column":3}},"line":38},"10":{"name":"(anonymous_10)","decl":{"start":{"line":39,"column":52},"end":{"line":39,"column":53}},"loc":{"start":{"line":39,"column":63},"end":{"line":42,"column":5}},"line":39},"11":{"name":"(anonymous_11)","decl":{"start":{"line":40,"column":14},"end":{"line":40,"column":15}},"loc":{"start":{"line":40,"column":22},"end":{"line":40,"column":26}},"line":40},"12":{"name":"(anonymous_12)","decl":{"start":{"line":42,"column":13},"end":{"line":42,"column":14}},"loc":{"start":{"line":42,"column":22},"end":{"line":45,"column":5}},"line":42},"13":{"name":"(anonymous_13)","decl":{"start":{"line":43,"column":14},"end":{"line":43,"column":15}},"loc":{"start":{"line":43,"column":22},"end":{"line":43,"column":26}},"line":43},"14":{"name":"(anonymous_14)","decl":{"start":{"line":48,"column":2},"end":{"line":48,"column":3}},"loc":{"start":{"line":48,"column":32},"end":{"line":143,"column":3}},"line":48},"15":{"name":"(anonymous_15)","decl":{"start":{"line":58,"column":19},"end":{"line":58,"column":20}},"loc":{"start":{"line":58,"column":28},"end":{"line":74,"column":5}},"line":58},"16":{"name":"(anonymous_16)","decl":{"start":{"line":113,"column":24},"end":{"line":113,"column":25}},"loc":{"start":{"line":113,"column":33},"end":{"line":118,"column":7}},"line":113},"17":{"name":"(anonymous_17)","decl":{"start":{"line":132,"column":38},"end":{"line":132,"column":39}},"loc":{"start":{"line":132,"column":49},"end":{"line":137,"column":5}},"line":132},"18":{"name":"(anonymous_18)","decl":{"start":{"line":133,"column":30},"end":{"line":133,"column":31}},"loc":{"start":{"line":133,"column":38},"end":{"line":133,"column":42}},"line":133},"19":{"name":"(anonymous_19)","decl":{"start":{"line":137,"column":13},"end":{"line":137,"column":14}},"loc":{"start":{"line":137,"column":20},"end":{"line":142,"column":5}},"line":137},"20":{"name":"(anonymous_20)","decl":{"start":{"line":138,"column":30},"end":{"line":138,"column":31}},"loc":{"start":{"line":138,"column":38},"end":{"line":138,"column":42}},"line":138}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":92}},"type":"cond-expr","locations":[{"start":{"line":15,"column":70},"end":{"line":15,"column":73}},{"start":{"line":15,"column":76},"end":{"line":15,"column":92}}],"line":15},"1":{"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":67}},"type":"binary-expr","locations":[{"start":{"line":15,"column":46},"end":{"line":15,"column":49}},{"start":{"line":15,"column":53},"end":{"line":15,"column":67}}],"line":15},"2":{"loc":{"start":{"line":17,"column":75},"end":{"line":17,"column":326}},"type":"if","locations":[{"start":{"line":17,"column":75},"end":{"line":17,"column":326}},{"start":{"line":17,"column":75},"end":{"line":17,"column":326}}],"line":17},"3":{"loc":{"start":{"line":17,"column":163},"end":{"line":17,"column":292}},"type":"if","locations":[{"start":{"line":17,"column":163},"end":{"line":17,"column":292}},{"start":{"line":17,"column":163},"end":{"line":17,"column":292}}],"line":17},"4":{"loc":{"start":{"line":19,"column":91},"end":{"line":19,"column":131}},"type":"cond-expr","locations":[{"start":{"line":19,"column":114},"end":{"line":19,"column":126}},{"start":{"line":19,"column":129},"end":{"line":19,"column":131}}],"line":19},"5":{"loc":{"start":{"line":19,"column":133},"end":{"line":19,"column":515}},"type":"if","locations":[{"start":{"line":19,"column":133},"end":{"line":19,"column":515}},{"start":{"line":19,"column":133},"end":{"line":19,"column":515}}],"line":19},"6":{"loc":{"start":{"line":19,"column":255},"end":{"line":19,"column":515}},"type":"if","locations":[{"start":{"line":19,"column":255},"end":{"line":19,"column":515}},{"start":{"line":19,"column":255},"end":{"line":19,"column":515}}],"line":19},"7":{"loc":{"start":{"line":21,"column":44},"end":{"line":21,"column":195}},"type":"if","locations":[{"start":{"line":21,"column":44},"end":{"line":21,"column":195}},{"start":{"line":21,"column":44},"end":{"line":21,"column":195}}],"line":21},"8":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31},"9":{"loc":{"start":{"line":40,"column":7},"end":{"line":40,"column":27}},"type":"binary-expr","locations":[{"start":{"line":40,"column":7},"end":{"line":40,"column":9}},{"start":{"line":40,"column":14},"end":{"line":40,"column":26}}],"line":40},"10":{"loc":{"start":{"line":43,"column":7},"end":{"line":43,"column":27}},"type":"binary-expr","locations":[{"start":{"line":43,"column":7},"end":{"line":43,"column":9}},{"start":{"line":43,"column":14},"end":{"line":43,"column":26}}],"line":43},"11":{"loc":{"start":{"line":56,"column":19},"end":{"line":56,"column":75}},"type":"cond-expr","locations":[{"start":{"line":56,"column":50},"end":{"line":56,"column":63}},{"start":{"line":56,"column":66},"end":{"line":56,"column":75}}],"line":56},"12":{"loc":{"start":{"line":56,"column":33},"end":{"line":56,"column":46}},"type":"binary-expr","locations":[{"start":{"line":56,"column":33},"end":{"line":56,"column":40}},{"start":{"line":56,"column":44},"end":{"line":56,"column":46}}],"line":56},"13":{"loc":{"start":{"line":56,"column":50},"end":{"line":56,"column":63}},"type":"binary-expr","locations":[{"start":{"line":56,"column":50},"end":{"line":56,"column":57}},{"start":{"line":56,"column":61},"end":{"line":56,"column":63}}],"line":56},"14":{"loc":{"start":{"line":59,"column":6},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":59,"column":6},"end":{"line":73,"column":7}},{"start":{"line":59,"column":6},"end":{"line":73,"column":7}}],"line":59},"15":{"loc":{"start":{"line":61,"column":13},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":61,"column":13},"end":{"line":73,"column":7}},{"start":{"line":61,"column":13},"end":{"line":73,"column":7}}],"line":61},"16":{"loc":{"start":{"line":63,"column":13},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":63,"column":13},"end":{"line":73,"column":7}},{"start":{"line":63,"column":13},"end":{"line":73,"column":7}}],"line":63},"17":{"loc":{"start":{"line":65,"column":13},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":65,"column":13},"end":{"line":73,"column":7}},{"start":{"line":65,"column":13},"end":{"line":73,"column":7}}],"line":65},"18":{"loc":{"start":{"line":67,"column":13},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":67,"column":13},"end":{"line":73,"column":7}},{"start":{"line":67,"column":13},"end":{"line":73,"column":7}}],"line":67},"19":{"loc":{"start":{"line":69,"column":13},"end":{"line":73,"column":7}},"type":"if","locations":[{"start":{"line":69,"column":13},"end":{"line":73,"column":7}},{"start":{"line":69,"column":13},"end":{"line":73,"column":7}}],"line":69},"20":{"loc":{"start":{"line":78,"column":6},"end":{"line":80,"column":7}},"type":"if","locations":[{"start":{"line":78,"column":6},"end":{"line":80,"column":7}},{"start":{"line":78,"column":6},"end":{"line":80,"column":7}}],"line":78},"21":{"loc":{"start":{"line":83,"column":6},"end":{"line":85,"column":7}},"type":"if","locations":[{"start":{"line":83,"column":6},"end":{"line":85,"column":7}},{"start":{"line":83,"column":6},"end":{"line":85,"column":7}}],"line":83},"22":{"loc":{"start":{"line":88,"column":6},"end":{"line":90,"column":7}},"type":"if","locations":[{"start":{"line":88,"column":6},"end":{"line":90,"column":7}},{"start":{"line":88,"column":6},"end":{"line":90,"column":7}}],"line":88},"23":{"loc":{"start":{"line":93,"column":6},"end":{"line":95,"column":7}},"type":"if","locations":[{"start":{"line":93,"column":6},"end":{"line":95,"column":7}},{"start":{"line":93,"column":6},"end":{"line":95,"column":7}}],"line":93},"24":{"loc":{"start":{"line":98,"column":6},"end":{"line":100,"column":7}},"type":"if","locations":[{"start":{"line":98,"column":6},"end":{"line":100,"column":7}},{"start":{"line":98,"column":6},"end":{"line":100,"column":7}}],"line":98},"25":{"loc":{"start":{"line":106,"column":4},"end":{"line":120,"column":5}},"type":"if","locations":[{"start":{"line":106,"column":4},"end":{"line":120,"column":5}},{"start":{"line":106,"column":4},"end":{"line":120,"column":5}}],"line":106},"26":{"loc":{"start":{"line":123,"column":4},"end":{"line":130,"column":5}},"type":"if","locations":[{"start":{"line":123,"column":4},"end":{"line":130,"column":5}},{"start":{"line":123,"column":4},"end":{"line":130,"column":5}}],"line":123},"27":{"loc":{"start":{"line":133,"column":17},"end":{"line":133,"column":43}},"type":"binary-expr","locations":[{"start":{"line":133,"column":17},"end":{"line":133,"column":25}},{"start":{"line":133,"column":30},"end":{"line":133,"column":42}}],"line":133},"28":{"loc":{"start":{"line":138,"column":17},"end":{"line":138,"column":43}},"type":"binary-expr","locations":[{"start":{"line":138,"column":17},"end":{"line":138,"column":25}},{"start":{"line":138,"column":30},"end":{"line":138,"column":42}}],"line":138}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":5,"7":40,"8":40,"9":40,"10":40,"11":40,"12":0,"13":40,"14":40,"15":20,"16":20,"17":60,"18":60,"19":40,"20":138,"21":20,"22":20,"23":0,"24":0,"25":20,"26":138,"27":18,"28":120,"29":138,"30":19,"31":20,"32":20,"33":1,"34":20,"35":82,"36":70,"37":70,"38":70,"39":10,"40":10,"41":10,"42":104,"43":104,"44":104,"45":104,"46":104,"47":104,"48":104,"49":104,"50":104,"51":286,"52":22,"53":264,"54":24,"55":240,"56":51,"57":189,"58":30,"59":159,"60":93,"61":66,"62":60,"63":6,"64":104,"65":104,"66":43,"67":102,"68":22,"69":102,"70":19,"71":102,"72":12,"73":100,"74":12,"75":4,"76":104,"77":6,"78":6,"79":6,"80":6,"81":104,"82":2,"83":104,"84":90,"85":35,"86":90,"87":90,"88":14,"89":7,"90":14,"91":14,"92":1},"f":{"0":5,"1":40,"2":0,"3":20,"4":138,"5":0,"6":138,"7":19,"8":20,"9":82,"10":70,"11":70,"12":10,"13":10,"14":104,"15":286,"16":6,"17":90,"18":35,"19":14,"20":7},"b":{"0":[0,5],"1":[5,5],"2":[40,0],"3":[40,0],"4":[53,7],"5":[40,20],"6":[20,0],"7":[18,120],"8":[1,19],"9":[70,70],"10":[10,10],"11":[88,16],"12":[104,2],"13":[88,2],"14":[22,264],"15":[24,240],"16":[51,189],"17":[30,159],"18":[93,66],"19":[60,6],"20":[43,61],"21":[22,80],"22":[19,83],"23":[12,90],"24":[12,88],"25":[6,98],"26":[2,102],"27":[90,35],"28":[14,7]},"inputSourceMap":{"version":3,"sources":["push-notifications.js"],"names":["PN","constructor","options","setOptions","opts","settings","DEFAULT_SETTINGS","apn","shutdown","APN","sendWith","method","regIds","data","cb","then","results","noop","catch","error","Promise","reject","send","_regIds","callback","promises","regIdsGCM","regIdsAPN","regIdsWNS","regIdsADM","regIdsWebPush","regIdsUnk","Array","isArray","forEach","regId","push","isAlwaysUseFCM","substring","test","length","sendGCM","sendAPN","bind","sendWNS","sendADM","sendWebPush","err","success","failure","message","Error","resolve","all","module","exports"],"mappings":"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","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["import sendGCM from './sendGCM';\nimport APN from './sendAPN';\nimport sendADM from './sendADM';\nimport sendWNS from './sendWNS';\nimport sendWebPush from './sendWeb';\nimport { DEFAULT_SETTINGS } from './constants';\n\nclass PN {\n  constructor(options) {\n    this.setOptions(options);\n  }\n\n  setOptions(opts) {\n    this.settings = { ...DEFAULT_SETTINGS, ...opts };\n    if (this.apn) {\n      this.apn.shutdown();\n    }\n    this.apn = new APN(this.settings.apn);\n  }\n\n  sendWith(method, regIds, data, cb) {\n    return method(regIds, data, this.settings)\n      .then(results => {\n        (cb || (noop => noop))(null, results);\n        return results;\n      })\n      .catch(error => {\n        (cb || (noop => noop))(error);\n        return Promise.reject(error);\n      });\n  }\n\n  send(_regIds, data, callback) {\n    const promises = [];\n    const regIdsGCM = [];\n    const regIdsAPN = [];\n    const regIdsWNS = [];\n    const regIdsADM = [];\n    const regIdsWebPush = [];\n    const regIdsUnk = [];\n    const regIds = Array.isArray(_regIds || []) ? _regIds || [] : [_regIds];\n\n    // Classify each pushId for corresponding device\n    regIds.forEach(regId => {\n      if (typeof regId === 'object') {\n        regIdsWebPush.push(regId);\n      } else if (this.settings.isAlwaysUseFCM) {\n        regIdsGCM.push(regId);\n      } else if (regId.substring(0, 4) === 'http') {\n        regIdsWNS.push(regId);\n      } else if (/^(amzn[0-9]*.adm)/i.test(regId)) {\n        regIdsADM.push(regId);\n      } else if (regId.length > 64) {\n        regIdsGCM.push(regId);\n      } else if (regId.length === 64) {\n        regIdsAPN.push(regId);\n      } else {\n        regIdsUnk.push(regId);\n      }\n    });\n\n    try {\n      // Android GCM\n      if (regIdsGCM.length > 0) {\n        promises.push(this.sendWith(sendGCM, regIdsGCM, data));\n      }\n\n      // iOS APN\n      if (regIdsAPN.length > 0) {\n        promises.push(\n          this.sendWith(this.apn.sendAPN.bind(this.apn), regIdsAPN, data)\n        );\n      }\n\n      // Microsoft WNS\n      if (regIdsWNS.length > 0) {\n        promises.push(this.sendWith(sendWNS, regIdsWNS, data));\n      }\n\n      // Amazon ADM\n      if (regIdsADM.length > 0) {\n        promises.push(this.sendWith(sendADM, regIdsADM, data));\n      }\n\n      // Web Push\n      if (regIdsWebPush.length > 0) {\n        promises.push(this.sendWith(sendWebPush, regIdsWebPush, data));\n      }\n    } catch (err) {\n      promises.push(Promise.reject(err));\n    }\n\n    // Unknown\n    if (regIdsUnk.length > 0) {\n      const results = {\n        method: 'unknown',\n        success: 0,\n        failure: regIdsUnk.length,\n        message: [],\n      };\n      regIdsUnk.forEach(regId => {\n        results.message.push({\n          regId,\n          error: new Error('Unknown registration id'),\n        });\n      });\n      promises.push(Promise.resolve(results));\n    }\n\n    // No regIds detected\n    if (promises.length === 0) {\n      promises.push(\n        Promise.resolve({\n          method: 'none',\n          success: 0,\n          failure: 0,\n          message: [],\n        })\n      );\n    }\n\n    return Promise.all(promises)\n      .then(results => {\n        const cb = callback || (noop => noop);\n        cb(null, results);\n        return results;\n      })\n      .catch(err => {\n        const cb = callback || (noop => noop);\n        cb(err);\n        return Promise.reject(err);\n      });\n  }\n}\n\nmodule.exports = PN;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ebf7427127d1aebb6dba61bd27dcaecac4d40712","contentHash":"596a4f41cec2ca201b707680eb9761b18b02313cd35a8d752340e8c3d072133b"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendGCM.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendGCM.js","statementMap":{"0":{"start":{"line":3,"column":54},"end":{"line":3,"column":73}},"1":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"2":{"start":{"line":3,"column":125},"end":{"line":3,"column":161}},"3":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"4":{"start":{"line":3,"column":183},"end":{"line":3,"column":292}},"5":{"start":{"line":3,"column":225},"end":{"line":3,"column":288}},"6":{"start":{"line":3,"column":293},"end":{"line":3,"column":324}},"7":{"start":{"line":3,"column":327},"end":{"line":3,"column":339}},"8":{"start":{"line":5,"column":33},"end":{"line":5,"column":517}},"9":{"start":{"line":5,"column":46},"end":{"line":5,"column":47}},"10":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"11":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"12":{"start":{"line":5,"column":146},"end":{"line":5,"column":247}},"13":{"start":{"line":5,"column":201},"end":{"line":5,"column":243}},"14":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"15":{"start":{"line":5,"column":295},"end":{"line":5,"column":369}},"16":{"start":{"line":5,"column":379},"end":{"line":5,"column":513}},"17":{"start":{"line":5,"column":428},"end":{"line":5,"column":509}},"18":{"start":{"line":5,"column":518},"end":{"line":5,"column":532}},"19":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"20":{"start":{"line":7,"column":62},"end":{"line":7,"column":166}},"21":{"start":{"line":7,"column":176},"end":{"line":7,"column":193}},"22":{"start":{"line":7,"column":196},"end":{"line":7,"column":207}},"23":{"start":{"line":9,"column":12},"end":{"line":9,"column":31}},"24":{"start":{"line":11,"column":10},"end":{"line":11,"column":26}},"25":{"start":{"line":13,"column":17},"end":{"line":13,"column":39}},"26":{"start":{"line":14,"column":20},"end":{"line":14,"column":40}},"27":{"start":{"line":15,"column":19},"end":{"line":15,"column":38}},"28":{"start":{"line":17,"column":22},"end":{"line":17,"column":70}},"29":{"start":{"line":17,"column":32},"end":{"line":17,"column":70}},"30":{"start":{"line":19,"column":26},"end":{"line":21,"column":116}},"31":{"start":{"line":21,"column":6},"end":{"line":21,"column":27}},"32":{"start":{"line":23,"column":18},"end":{"line":74,"column":2}},"33":{"start":{"line":23,"column":71},"end":{"line":74,"column":2}},"34":{"start":{"line":24,"column":2},"end":{"line":73,"column":5}},"35":{"start":{"line":28,"column":4},"end":{"line":72,"column":5}},"36":{"start":{"line":29,"column":6},"end":{"line":39,"column":9}},"37":{"start":{"line":33,"column":50},"end":{"line":38,"column":9}},"38":{"start":{"line":40,"column":11},"end":{"line":72,"column":5}},"39":{"start":{"line":41,"column":21},"end":{"line":41,"column":22}},"40":{"start":{"line":42,"column":6},"end":{"line":58,"column":9}},"41":{"start":{"line":48,"column":27},"end":{"line":48,"column":55}},"42":{"start":{"line":49,"column":10},"end":{"line":49,"column":24}},"43":{"start":{"line":50,"column":10},"end":{"line":56,"column":12}},"44":{"start":{"line":60,"column":6},"end":{"line":71,"column":9}},"45":{"start":{"line":65,"column":50},"end":{"line":70,"column":9}},"46":{"start":{"line":76,"column":16},"end":{"line":181,"column":1}},"47":{"start":{"line":77,"column":15},"end":{"line":77,"column":46}},"48":{"start":{"line":79,"column":13},"end":{"line":79,"column":20}},"49":{"start":{"line":80,"column":2},"end":{"line":80,"column":17}},"50":{"start":{"line":81,"column":20},"end":{"line":81,"column":44}},"51":{"start":{"line":82,"column":19},"end":{"line":82,"column":21}},"52":{"start":{"line":83,"column":23},"end":{"line":116,"column":3}},"53":{"start":{"line":119,"column":2},"end":{"line":129,"column":3}},"54":{"start":{"line":120,"column":4},"end":{"line":122,"column":6}},"55":{"start":{"line":123,"column":9},"end":{"line":129,"column":3}},"56":{"start":{"line":124,"column":4},"end":{"line":124,"column":44}},"57":{"start":{"line":126,"column":4},"end":{"line":128,"column":6}},"58":{"start":{"line":131,"column":2},"end":{"line":131,"column":44}},"59":{"start":{"line":132,"column":2},"end":{"line":132,"column":47}},"60":{"start":{"line":133,"column":2},"end":{"line":133,"column":44}},"61":{"start":{"line":134,"column":2},"end":{"line":134,"column":41}},"62":{"start":{"line":135,"column":2},"end":{"line":135,"column":46}},"63":{"start":{"line":137,"column":2},"end":{"line":139,"column":3}},"64":{"start":{"line":138,"column":4},"end":{"line":138,"column":36}},"65":{"start":{"line":141,"column":18},"end":{"line":153,"column":4}},"66":{"start":{"line":154,"column":14},"end":{"line":154,"column":15}},"67":{"start":{"line":156,"column":2},"end":{"line":160,"column":41}},"68":{"start":{"line":157,"column":19},"end":{"line":157,"column":65}},"69":{"start":{"line":158,"column":4},"end":{"line":158,"column":76}},"70":{"start":{"line":159,"column":4},"end":{"line":159,"column":15}},"71":{"start":{"line":162,"column":2},"end":{"line":180,"column":5}},"72":{"start":{"line":163,"column":20},"end":{"line":169,"column":5}},"73":{"start":{"line":170,"column":4},"end":{"line":178,"column":7}},"74":{"start":{"line":171,"column":6},"end":{"line":173,"column":7}},"75":{"start":{"line":172,"column":8},"end":{"line":172,"column":53}},"76":{"start":{"line":175,"column":6},"end":{"line":175,"column":40}},"77":{"start":{"line":176,"column":6},"end":{"line":176,"column":40}},"78":{"start":{"line":177,"column":6},"end":{"line":177,"column":46}},"79":{"start":{"line":179,"column":4},"end":{"line":179,"column":19}},"80":{"start":{"line":183,"column":0},"end":{"line":183,"column":25}}},"fnMap":{"0":{"name":"ownKeys","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":41},"end":{"line":3,"column":341}},"line":3},"1":{"name":"(anonymous_1)","decl":{"start":{"line":3,"column":208},"end":{"line":3,"column":209}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":290}},"line":3},"2":{"name":"_objectSpread","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":22}},"loc":{"start":{"line":5,"column":31},"end":{"line":5,"column":534}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":5,"column":184},"end":{"line":5,"column":185}},"loc":{"start":{"line":5,"column":199},"end":{"line":5,"column":245}},"line":5},"4":{"name":"(anonymous_4)","decl":{"start":{"line":5,"column":411},"end":{"line":5,"column":412}},"loc":{"start":{"line":5,"column":426},"end":{"line":5,"column":511}},"line":5},"5":{"name":"_defineProperty","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":24}},"loc":{"start":{"line":7,"column":42},"end":{"line":7,"column":209}},"line":7},"6":{"name":"(anonymous_6)","decl":{"start":{"line":17,"column":22},"end":{"line":17,"column":23}},"loc":{"start":{"line":17,"column":32},"end":{"line":17,"column":70}},"line":17},"7":{"name":"(anonymous_7)","decl":{"start":{"line":19,"column":63},"end":{"line":19,"column":64}},"loc":{"start":{"line":21,"column":6},"end":{"line":21,"column":27}},"line":21},"8":{"name":"(anonymous_8)","decl":{"start":{"line":23,"column":18},"end":{"line":23,"column":19}},"loc":{"start":{"line":23,"column":71},"end":{"line":74,"column":2}},"line":23},"9":{"name":"(anonymous_9)","decl":{"start":{"line":23,"column":83},"end":{"line":23,"column":84}},"loc":{"start":{"line":23,"column":94},"end":{"line":74,"column":1}},"line":23},"10":{"name":"(anonymous_10)","decl":{"start":{"line":26,"column":14},"end":{"line":26,"column":15}},"loc":{"start":{"line":26,"column":33},"end":{"line":73,"column":3}},"line":26},"11":{"name":"(anonymous_11)","decl":{"start":{"line":33,"column":40},"end":{"line":33,"column":41}},"loc":{"start":{"line":33,"column":50},"end":{"line":38,"column":9}},"line":33},"12":{"name":"(anonymous_12)","decl":{"start":{"line":47,"column":38},"end":{"line":47,"column":39}},"loc":{"start":{"line":47,"column":47},"end":{"line":57,"column":9}},"line":47},"13":{"name":"(anonymous_13)","decl":{"start":{"line":65,"column":40},"end":{"line":65,"column":41}},"loc":{"start":{"line":65,"column":50},"end":{"line":70,"column":9}},"line":65},"14":{"name":"(anonymous_14)","decl":{"start":{"line":76,"column":16},"end":{"line":76,"column":17}},"loc":{"start":{"line":76,"column":44},"end":{"line":181,"column":1}},"line":76},"15":{"name":"(anonymous_15)","decl":{"start":{"line":162,"column":36},"end":{"line":162,"column":37}},"loc":{"start":{"line":162,"column":47},"end":{"line":180,"column":3}},"line":162},"16":{"name":"(anonymous_16)","decl":{"start":{"line":170,"column":20},"end":{"line":170,"column":21}},"loc":{"start":{"line":170,"column":30},"end":{"line":178,"column":5}},"line":170}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"type":"if","locations":[{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},{"start":{"line":3,"column":75},"end":{"line":3,"column":326}}],"line":3},"1":{"loc":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"type":"if","locations":[{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},{"start":{"line":3,"column":163},"end":{"line":3,"column":292}}],"line":3},"2":{"loc":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"type":"cond-expr","locations":[{"start":{"line":5,"column":114},"end":{"line":5,"column":126}},{"start":{"line":5,"column":129},"end":{"line":5,"column":131}}],"line":5},"3":{"loc":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},{"start":{"line":5,"column":133},"end":{"line":5,"column":515}}],"line":5},"4":{"loc":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},{"start":{"line":5,"column":255},"end":{"line":5,"column":515}}],"line":5},"5":{"loc":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"type":"if","locations":[{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},{"start":{"line":7,"column":44},"end":{"line":7,"column":195}}],"line":7},"6":{"loc":{"start":{"line":28,"column":4},"end":{"line":72,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":72,"column":5}},{"start":{"line":28,"column":4},"end":{"line":72,"column":5}}],"line":28},"7":{"loc":{"start":{"line":37,"column":20},"end":{"line":37,"column":60}},"type":"cond-expr","locations":[{"start":{"line":37,"column":43},"end":{"line":37,"column":54}},{"start":{"line":37,"column":57},"end":{"line":37,"column":60}}],"line":37},"8":{"loc":{"start":{"line":40,"column":11},"end":{"line":72,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":11},"end":{"line":72,"column":5}},{"start":{"line":40,"column":11},"end":{"line":72,"column":5}}],"line":40},"9":{"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":57}},"type":"binary-expr","locations":[{"start":{"line":40,"column":15},"end":{"line":40,"column":23}},{"start":{"line":40,"column":27},"end":{"line":40,"column":57}}],"line":40},"10":{"loc":{"start":{"line":53,"column":19},"end":{"line":53,"column":52}},"type":"binary-expr","locations":[{"start":{"line":53,"column":19},"end":{"line":53,"column":40}},{"start":{"line":53,"column":44},"end":{"line":53,"column":52}}],"line":53},"11":{"loc":{"start":{"line":54,"column":19},"end":{"line":54,"column":62}},"type":"cond-expr","locations":[{"start":{"line":54,"column":33},"end":{"line":54,"column":55}},{"start":{"line":54,"column":58},"end":{"line":54,"column":62}}],"line":54},"12":{"loc":{"start":{"line":55,"column":22},"end":{"line":55,"column":77}},"type":"cond-expr","locations":[{"start":{"line":55,"column":36},"end":{"line":55,"column":70}},{"start":{"line":55,"column":73},"end":{"line":55,"column":77}}],"line":55},"13":{"loc":{"start":{"line":55,"column":36},"end":{"line":55,"column":70}},"type":"binary-expr","locations":[{"start":{"line":55,"column":36},"end":{"line":55,"column":55}},{"start":{"line":55,"column":59},"end":{"line":55,"column":70}}],"line":55},"14":{"loc":{"start":{"line":104,"column":18},"end":{"line":104,"column":51}},"type":"binary-expr","locations":[{"start":{"line":104,"column":18},"end":{"line":104,"column":34}},{"start":{"line":104,"column":38},"end":{"line":104,"column":51}}],"line":104},"15":{"loc":{"start":{"line":119,"column":2},"end":{"line":129,"column":3}},"type":"if","locations":[{"start":{"line":119,"column":2},"end":{"line":129,"column":3}},{"start":{"line":119,"column":2},"end":{"line":129,"column":3}}],"line":119},"16":{"loc":{"start":{"line":123,"column":9},"end":{"line":129,"column":3}},"type":"if","locations":[{"start":{"line":123,"column":9},"end":{"line":129,"column":3}},{"start":{"line":123,"column":9},"end":{"line":129,"column":3}}],"line":123},"17":{"loc":{"start":{"line":131,"column":17},"end":{"line":131,"column":43}},"type":"binary-expr","locations":[{"start":{"line":131,"column":17},"end":{"line":131,"column":29}},{"start":{"line":131,"column":33},"end":{"line":131,"column":43}}],"line":131},"18":{"loc":{"start":{"line":132,"column":19},"end":{"line":132,"column":46}},"type":"binary-expr","locations":[{"start":{"line":132,"column":19},"end":{"line":132,"column":33}},{"start":{"line":132,"column":37},"end":{"line":132,"column":46}}],"line":132},"19":{"loc":{"start":{"line":133,"column":17},"end":{"line":133,"column":43}},"type":"binary-expr","locations":[{"start":{"line":133,"column":17},"end":{"line":133,"column":29}},{"start":{"line":133,"column":33},"end":{"line":133,"column":43}}],"line":133},"20":{"loc":{"start":{"line":134,"column":16},"end":{"line":134,"column":40}},"type":"binary-expr","locations":[{"start":{"line":134,"column":16},"end":{"line":134,"column":27}},{"start":{"line":134,"column":31},"end":{"line":134,"column":40}}],"line":134},"21":{"loc":{"start":{"line":135,"column":18},"end":{"line":135,"column":45}},"type":"binary-expr","locations":[{"start":{"line":135,"column":18},"end":{"line":135,"column":31}},{"start":{"line":135,"column":35},"end":{"line":135,"column":45}}],"line":135},"22":{"loc":{"start":{"line":137,"column":2},"end":{"line":139,"column":3}},"type":"if","locations":[{"start":{"line":137,"column":2},"end":{"line":139,"column":3}},{"start":{"line":137,"column":2},"end":{"line":139,"column":3}}],"line":137},"23":{"loc":{"start":{"line":137,"column":6},"end":{"line":137,"column":53}},"type":"binary-expr","locations":[{"start":{"line":137,"column":6},"end":{"line":137,"column":28}},{"start":{"line":137,"column":32},"end":{"line":137,"column":53}}],"line":137},"24":{"loc":{"start":{"line":144,"column":14},"end":{"line":144,"column":65}},"type":"cond-expr","locations":[{"start":{"line":144,"column":43},"end":{"line":144,"column":56}},{"start":{"line":144,"column":59},"end":{"line":144,"column":65}}],"line":144},"25":{"loc":{"start":{"line":145,"column":22},"end":{"line":145,"column":52}},"type":"binary-expr","locations":[{"start":{"line":145,"column":22},"end":{"line":145,"column":43}},{"start":{"line":145,"column":47},"end":{"line":145,"column":52}}],"line":145},"26":{"loc":{"start":{"line":146,"column":20},"end":{"line":146,"column":48}},"type":"binary-expr","locations":[{"start":{"line":146,"column":20},"end":{"line":146,"column":39}},{"start":{"line":146,"column":43},"end":{"line":146,"column":48}}],"line":146},"27":{"loc":{"start":{"line":149,"column":12},"end":{"line":149,"column":32}},"type":"binary-expr","locations":[{"start":{"line":149,"column":12},"end":{"line":149,"column":23}},{"start":{"line":149,"column":27},"end":{"line":149,"column":32}}],"line":149},"28":{"loc":{"start":{"line":150,"column":10},"end":{"line":150,"column":79}},"type":"cond-expr","locations":[{"start":{"line":150,"column":35},"end":{"line":150,"column":70}},{"start":{"line":150,"column":73},"end":{"line":150,"column":79}}],"line":150},"29":{"loc":{"start":{"line":152,"column":18},"end":{"line":152,"column":67}},"type":"cond-expr","locations":[{"start":{"line":152,"column":43},"end":{"line":152,"column":52}},{"start":{"line":152,"column":55},"end":{"line":152,"column":67}}],"line":152},"30":{"loc":{"start":{"line":158,"column":56},"end":{"line":158,"column":73}},"type":"binary-expr","locations":[{"start":{"line":158,"column":56},"end":{"line":158,"column":68}},{"start":{"line":158,"column":72},"end":{"line":158,"column":73}}],"line":158},"31":{"loc":{"start":{"line":171,"column":6},"end":{"line":173,"column":7}},"type":"if","locations":[{"start":{"line":171,"column":6},"end":{"line":173,"column":7}},{"start":{"line":171,"column":6},"end":{"line":173,"column":7}}],"line":171}},"s":{"0":63,"1":63,"2":63,"3":63,"4":63,"5":0,"6":63,"7":63,"8":63,"9":63,"10":63,"11":63,"12":63,"13":81,"14":0,"15":0,"16":0,"17":0,"18":63,"19":81,"20":0,"21":81,"22":81,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":33,"34":33,"35":31,"36":2,"37":6,"38":29,"39":27,"40":27,"41":81,"42":81,"43":81,"44":2,"45":6,"46":1,"47":33,"48":33,"49":33,"50":33,"51":33,"52":33,"53":33,"54":1,"55":32,"56":30,"57":2,"58":33,"59":33,"60":33,"61":33,"62":33,"63":33,"64":2,"65":33,"66":33,"67":33,"68":33,"69":33,"70":33,"71":33,"72":31,"73":31,"74":31,"75":29,"76":31,"77":31,"78":31,"79":31,"80":1},"f":{"0":63,"1":0,"2":63,"3":81,"4":0,"5":81,"6":1,"7":1,"8":33,"9":33,"10":31,"11":6,"12":81,"13":6,"14":33,"15":31,"16":31},"b":{"0":[63,0],"1":[63,0],"2":[63,0],"3":[63,0],"4":[0,0],"5":[0,81],"6":[2,29],"7":[6,0],"8":[27,2],"9":[29,29],"10":[81,0],"11":[6,75],"12":[6,75],"13":[6,6],"14":[33,33],"15":[1,32],"16":[30,2],"17":[33,33],"18":[33,32],"19":[33,33],"20":[33,33],"21":[33,15],"22":[2,31],"23":[33,2],"24":[2,31],"25":[33,10],"26":[33,33],"27":[33,33],"28":[2,31],"29":[2,31],"30":[33,33],"31":[29,2]},"inputSourceMap":{"version":3,"sources":["sendGCM.js"],"names":["gcm","require","R","DEFAULT_TTL","GCM_METHOD","ttlFromExpiry","expiry","Math","floor","Date","now","extractTimeToLive","cond","propIs","Number","prop","T","always","sendChunk","GCMSender","registrationTokens","message","retries","Promise","resolve","send","err","response","method","success","failure","length","map","value","originalRegId","regId","error","errorMsg","Error","results","undefined","regIndex","multicastId","multicast_id","regToken","messageId","message_id","registration_id","sendGCM","regIds","data","settings","opts","id","Sender","promises","notification","title","body","icon","image","picture","style","sound","badge","tag","color","click_action","clickAction","category","body_loc_key","locKey","body_loc_args","locArgs","title_loc_key","titleLocKey","title_loc_args","titleLocArgs","android_channel_id","custom","msgcnt","phonegap","contentAvailable","Message","collapseKey","priority","delayWhileIdle","timeToLive","restrictedPackageName","dryRun","Object","assign","chunk","tokens","slice","push","all","then","resumed","forEach","result","module","exports"],"mappings":"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","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["const gcm = require('node-gcm');\nconst R = require('ramda');\nconst { DEFAULT_TTL, GCM_METHOD } = require('./constants');\n\nconst ttlFromExpiry = expiry => expiry - Math.floor(Date.now() / 1000);\n\nconst extractTimeToLive = R.cond([\n  [R.propIs(Number, 'expiry'), ({ expiry }) => ttlFromExpiry(expiry)],\n  [R.propIs(Number, 'timeToLive'), R.prop('timeToLive')],\n  [R.T, R.always(DEFAULT_TTL)],\n]);\n\nconst sendChunk = (GCMSender, registrationTokens, message, retries) =>\n  new Promise(resolve => {\n    GCMSender.send(\n      message,\n      { registrationTokens },\n      retries,\n      (err, response) => {\n        // Response: see https://developers.google.com/cloud-messaging/http-server-ref#table5\n        if (err) {\n          resolve({\n            method: GCM_METHOD,\n            success: 0,\n            failure: registrationTokens.length,\n            message: registrationTokens.map(value => ({\n              originalRegId: value,\n              regId: value,\n              error: err,\n              errorMsg: err instanceof Error ? err.message : err,\n            })),\n          });\n        } else if (response && response.results !== undefined) {\n          let regIndex = 0;\n          resolve({\n            method: GCM_METHOD,\n            multicastId: response.multicast_id,\n            success: response.success,\n            failure: response.failure,\n            message: response.results.map(value => {\n              const regToken = registrationTokens[regIndex];\n              regIndex += 1;\n              return {\n                messageId: value.message_id,\n                originalRegId: regToken,\n                regId: value.registration_id || regToken,\n                error: value.error ? new Error(value.error) : null,\n                errorMsg: value.error\n                  ? value.error.message || value.error\n                  : null,\n              };\n            }),\n          });\n        } else {\n          resolve({\n            method: GCM_METHOD,\n            multicastId: response.multicast_id,\n            success: response.success,\n            failure: response.failure,\n            message: registrationTokens.map(value => ({\n              originalRegId: value,\n              regId: value,\n              error: new Error('unknown'),\n              errorMsg: 'unknown',\n            })),\n          });\n        }\n      }\n    );\n  });\n\nconst sendGCM = (regIds, data, settings) => {\n  const opts = { ...settings.gcm };\n  const { id } = opts;\n  delete opts.id;\n  const GCMSender = new gcm.Sender(id, opts);\n  const promises = [];\n  const notification = {\n    title: data.title, // Android, iOS (Watch)\n    body: data.body, // Android, iOS\n    icon: data.icon, // Android\n    image: data.image, // Android\n    picture: data.picture, // Android\n    style: data.style, // Android\n    sound: data.sound, // Android, iOS\n    badge: data.badge, // iOS\n    tag: data.tag, // Android\n    color: data.color, // Android\n    click_action: data.clickAction || data.category, // Android, iOS\n    body_loc_key: data.locKey, // Android, iOS\n    body_loc_args: data.locArgs, // Android, iOS\n    title_loc_key: data.titleLocKey, // Android, iOS\n    title_loc_args: data.titleLocArgs, // Android, iOS\n    android_channel_id: data.android_channel_id, // Android\n  };\n\n  let custom;\n  if (typeof data.custom === 'string') {\n    custom = {\n      message: data.custom,\n    };\n  } else if (typeof data.custom === 'object') {\n    custom = { ...data.custom };\n  } else {\n    custom = {\n      data: data.custom,\n    };\n  }\n\n  custom.title = custom.title || data.title;\n  custom.message = custom.message || data.body;\n  custom.sound = custom.sound || data.sound;\n  custom.icon = custom.icon || data.icon;\n  custom.msgcnt = custom.msgcnt || data.badge;\n  if (opts.phonegap === true && data.contentAvailable) {\n    custom['content-available'] = 1;\n  }\n\n  const message = new gcm.Message({\n    // See https://developers.google.com/cloud-messaging/http-server-ref#table5\n    collapseKey: data.collapseKey,\n    priority: data.priority === 'normal' ? data.priority : 'high',\n    contentAvailable: data.contentAvailable || false,\n    delayWhileIdle: data.delayWhileIdle || false,\n    timeToLive: extractTimeToLive(data),\n    restrictedPackageName: data.restrictedPackageName,\n    dryRun: data.dryRun || false,\n    data: opts.phonegap === true ? Object.assign(custom, notification) : custom, // See https://github.com/phonegap/phonegap-plugin-push/blob/master/docs/PAYLOAD.md#android-behaviour\n    notification: opts.phonegap === true ? undefined : notification,\n  });\n  let chunk = 0;\n\n  // Split in 1.000 chunks, see https://developers.google.com/cloud-messaging/http-server-ref#table1\n  do {\n    const tokens = regIds.slice(chunk * 1000, (chunk + 1) * 1000);\n    promises.push(sendChunk(GCMSender, tokens, message, data.retries || 0));\n    chunk += 1;\n  } while (1000 * chunk < regIds.length);\n\n  return Promise.all(promises).then(results => {\n    const resumed = {\n      method: GCM_METHOD,\n      multicastId: [],\n      success: 0,\n      failure: 0,\n      message: [],\n    };\n\n    results.forEach(result => {\n      if (result.multicastId) {\n        resumed.multicastId.push(result.multicastId);\n      }\n      resumed.success += result.success;\n      resumed.failure += result.failure;\n      resumed.message.push(...result.message);\n    });\n\n    return resumed;\n  });\n};\n\nmodule.exports = sendGCM;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"89ede2a889d6f0bce14a707da0883c920fc8d414","contentHash":"138814c0061d829fc2770e850477cb020aba3d8d0d26a0a07b970b3042d9dba7"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/constants.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/constants.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":73,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["constants.js"],"names":["module","exports","DEFAULT_TTL","APN_METHOD","GCM_METHOD","ADM_METHOD","WNS_METHOD","WEB_METHOD","DEFAULT_SETTINGS","gcm","id","apn","token","cert","key","ca","pfx","passphrase","production","process","env","NODE_ENV","voip","address","port","rejectUnauthorized","connectionRetryLimit","cacheLength","connectionTimeout","autoAdjustCache","maxConnections","minConnections","connectTimeout","buffersNotifications","fastMode","disableNagle","disableEPIPEFix","adm","client_id","client_secret","wns","accessToken","headers","notificationMethod","web","vapidDetails","subject","publicKey","privateKey","isAlwaysUseFCM"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,WAAW,EAAE,KAAK,KADH;AAEfC,EAAAA,UAAU,EAAE,KAFG;AAGfC,EAAAA,UAAU,EAAE,KAHG;AAIfC,EAAAA,UAAU,EAAE,KAJG;AAKfC,EAAAA,UAAU,EAAE,KALG;AAMfC,EAAAA,UAAU,EAAE,SANG;AAOfC,EAAAA,gBAAgB,EAAE;AAChBC,IAAAA,GAAG,EAAE;AACHC,MAAAA,EAAE,EAAE,IADD,CACO;;AADP,KADW;AAIhBC,IAAAA,GAAG,EAAE;AACH;AACAC,MAAAA,KAAK,EAAE,IAFJ;AAGH;AACA;AACA;AACA;AACA;AACAC,MAAAA,IAAI,EAAE,UARH;AASHC,MAAAA,GAAG,EAAE,SATF;AAUHC,MAAAA,EAAE,EAAE,IAVD;AAWHC,MAAAA,GAAG,EAAE,IAXF;AAYHC,MAAAA,UAAU,EAAE,IAZT;AAaHC,MAAAA,UAAU,EAAEC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAblC;AAcHC,MAAAA,IAAI,EAAE,KAdH;AAeHC,MAAAA,OAAO,EAAE,IAfN;AAgBHC,MAAAA,IAAI,EAAE,GAhBH;AAiBHC,MAAAA,kBAAkB,EAAE,IAjBjB;AAkBHC,MAAAA,oBAAoB,EAAE,EAlBnB;AAoBHC,MAAAA,WAAW,EAAE,IApBV;AAqBHC,MAAAA,iBAAiB,EAAE,OArBhB;AAsBHC,MAAAA,eAAe,EAAE,IAtBd;AAuBHC,MAAAA,cAAc,EAAE,CAvBb;AAwBHC,MAAAA,cAAc,EAAE,CAxBb;AAyBHC,MAAAA,cAAc,EAAE,KAzBb;AA0BHC,MAAAA,oBAAoB,EAAE,IA1BnB;AA2BHC,MAAAA,QAAQ,EAAE,KA3BP;AA4BHC,MAAAA,YAAY,EAAE,KA5BX;AA6BHC,MAAAA,eAAe,EAAE;AA7Bd,KAJW;AAmChBC,IAAAA,GAAG,EAAE;AACHC,MAAAA,SAAS,EAAE,IADR;AACc;AACjBC,MAAAA,aAAa,EAAE,IAFZ,CAEkB;;AAFlB,KAnCW;AAuChBC,IAAAA,GAAG,EAAE;AACHF,MAAAA,SAAS,EAAE,IADR;AACc;AACjBC,MAAAA,aAAa,EAAE,IAFZ;AAEkB;AACrBE,MAAAA,WAAW,EAAE,IAHV;AAIHC,MAAAA,OAAO,EAAE,IAJN;AAKHC,MAAAA,kBAAkB,EAAE;AALjB,KAvCW;AA8ChBC,IAAAA,GAAG,EAAE;AACHC,MAAAA,YAAY,EAAE;AACZC,QAAAA,OAAO,EAAE,6BADG;AAEZC,QAAAA,SAAS,EAAE,wCAFC;AAGZC,QAAAA,UAAU,EAAE;AAHA,OADX,CAMH;AACA;AACA;AACA;;AATG,KA9CW;AAyDhBC,IAAAA,cAAc,EAAE;AAzDA;AAPH,CAAjB","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["module.exports = {\n  DEFAULT_TTL: 28 * 86400,\n  APN_METHOD: 'apn',\n  GCM_METHOD: 'gcm',\n  ADM_METHOD: 'adm',\n  WNS_METHOD: 'wns',\n  WEB_METHOD: 'webPush',\n  DEFAULT_SETTINGS: {\n    gcm: {\n      id: null, // PUT YOUR GCM SERVER API KEY,\n    },\n    apn: {\n      // See options at https://github.com/node-apn/node-apn/blob/master/doc/provider.markdown\n      token: null,\n      // {\n      //     key: '',\n      //     keyId: '',\n      //     teamId: '',\n      // },\n      cert: 'cert.pem',\n      key: 'key.pem',\n      ca: null,\n      pfx: null,\n      passphrase: null,\n      production: process.env.NODE_ENV === 'production',\n      voip: false,\n      address: null,\n      port: 443,\n      rejectUnauthorized: true,\n      connectionRetryLimit: 10,\n\n      cacheLength: 1000,\n      connectionTimeout: 3600000,\n      autoAdjustCache: true,\n      maxConnections: 1,\n      minConnections: 1,\n      connectTimeout: 10000,\n      buffersNotifications: true,\n      fastMode: false,\n      disableNagle: false,\n      disableEPIPEFix: false,\n    },\n    adm: {\n      client_id: null, // PUT YOUR ADM CLIENT ID,\n      client_secret: null, // PUT YOUR ADM CLIENT SECRET,\n    },\n    wns: {\n      client_id: null, // PUT YOUR WNS CLIENT ID,\n      client_secret: null, // PUT YOUR WNS CLIENT SECRET,\n      accessToken: null,\n      headers: null,\n      notificationMethod: 'sendTileSquareBlock',\n    },\n    web: {\n      vapidDetails: {\n        subject: \"< 'mailto' Address or URL >\",\n        publicKey: '< URL Safe Base64 Encoded Public Key >',\n        privateKey: '< URL Safe Base64 Encoded Private Key >',\n      },\n      // gcmAPIKey: '< GCM API Key >',\n      // TTL: 2419200\n      // headers: { }\n      // contentEncoding: '< Encoding type, e.g.: aesgcm or aes128gcm >'\n    },\n    isAlwaysUseFCM: false,\n  },\n};\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8e2c8605b93db2ff91522c08cccbfe70f1852355","contentHash":"a3e22b217724921c88288b024f12baadae7e0f98eb97d3cc648dc07f840b8fa5"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendAPN.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendAPN.js","statementMap":{"0":{"start":{"line":3,"column":12},"end":{"line":3,"column":38}},"1":{"start":{"line":5,"column":10},"end":{"line":5,"column":26}},"2":{"start":{"line":7,"column":17},"end":{"line":7,"column":39}},"3":{"start":{"line":8,"column":20},"end":{"line":8,"column":40}},"4":{"start":{"line":9,"column":19},"end":{"line":9,"column":38}},"5":{"start":{"line":11,"column":22},"end":{"line":11,"column":64}},"6":{"start":{"line":11,"column":29},"end":{"line":11,"column":64}},"7":{"start":{"line":13,"column":22},"end":{"line":15,"column":75}},"8":{"start":{"line":15,"column":6},"end":{"line":15,"column":31}},"9":{"start":{"line":15,"column":46},"end":{"line":15,"column":72}},"10":{"start":{"line":19,"column":4},"end":{"line":24,"column":5}},"11":{"start":{"line":20,"column":6},"end":{"line":20,"column":51}},"12":{"start":{"line":22,"column":6},"end":{"line":22,"column":31}},"13":{"start":{"line":23,"column":6},"end":{"line":23,"column":29}},"14":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"15":{"start":{"line":29,"column":6},"end":{"line":29,"column":33}},"16":{"start":{"line":34,"column":20},"end":{"line":63,"column":6}},"17":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"18":{"start":{"line":66,"column":6},"end":{"line":66,"column":120}},"19":{"start":{"line":69,"column":4},"end":{"line":105,"column":7}},"20":{"start":{"line":70,"column":22},"end":{"line":75,"column":7}},"21":{"start":{"line":76,"column":6},"end":{"line":82,"column":9}},"22":{"start":{"line":77,"column":8},"end":{"line":77,"column":29}},"23":{"start":{"line":78,"column":8},"end":{"line":81,"column":11}},"24":{"start":{"line":83,"column":6},"end":{"line":103,"column":9}},"25":{"start":{"line":85,"column":8},"end":{"line":85,"column":29}},"26":{"start":{"line":87,"column":8},"end":{"line":102,"column":9}},"27":{"start":{"line":89,"column":10},"end":{"line":93,"column":13}},"28":{"start":{"line":97,"column":10},"end":{"line":101,"column":13}},"29":{"start":{"line":104,"column":6},"end":{"line":104,"column":21}},"30":{"start":{"line":110,"column":0},"end":{"line":110,"column":21}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":22},"end":{"line":11,"column":23}},"loc":{"start":{"line":11,"column":29},"end":{"line":11,"column":64}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":111},"end":{"line":13,"column":112}},"loc":{"start":{"line":15,"column":6},"end":{"line":15,"column":31}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":40},"end":{"line":15,"column":41}},"loc":{"start":{"line":15,"column":46},"end":{"line":15,"column":72}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":2},"end":{"line":18,"column":3}},"loc":{"start":{"line":18,"column":24},"end":{"line":25,"column":3}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":2},"end":{"line":27,"column":3}},"loc":{"start":{"line":27,"column":13},"end":{"line":31,"column":3}},"line":27},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":2},"end":{"line":33,"column":3}},"loc":{"start":{"line":33,"column":24},"end":{"line":106,"column":3}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":69,"column":54},"end":{"line":69,"column":55}},"loc":{"start":{"line":69,"column":66},"end":{"line":105,"column":5}},"line":69},"7":{"name":"(anonymous_7)","decl":{"start":{"line":76,"column":36},"end":{"line":76,"column":37}},"loc":{"start":{"line":76,"column":45},"end":{"line":82,"column":7}},"line":76},"8":{"name":"(anonymous_8)","decl":{"start":{"line":83,"column":38},"end":{"line":83,"column":39}},"loc":{"start":{"line":83,"column":49},"end":{"line":103,"column":7}},"line":83}},"branchMap":{"0":{"loc":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},{"start":{"line":28,"column":4},"end":{"line":30,"column":5}}],"line":28},"1":{"loc":{"start":{"line":35,"column":18},"end":{"line":35,"column":36}},"type":"binary-expr","locations":[{"start":{"line":35,"column":18},"end":{"line":35,"column":30}},{"start":{"line":35,"column":34},"end":{"line":35,"column":36}}],"line":35},"2":{"loc":{"start":{"line":37,"column":16},"end":{"line":37,"column":51}},"type":"cond-expr","locations":[{"start":{"line":37,"column":45},"end":{"line":37,"column":46}},{"start":{"line":37,"column":49},"end":{"line":37,"column":51}}],"line":37},"3":{"loc":{"start":{"line":39,"column":15},"end":{"line":39,"column":32}},"type":"binary-expr","locations":[{"start":{"line":39,"column":15},"end":{"line":39,"column":26}},{"start":{"line":39,"column":30},"end":{"line":39,"column":32}}],"line":39},"4":{"loc":{"start":{"line":42,"column":13},"end":{"line":52,"column":7}},"type":"binary-expr","locations":[{"start":{"line":42,"column":13},"end":{"line":42,"column":23}},{"start":{"line":42,"column":27},"end":{"line":52,"column":7}}],"line":42},"5":{"loc":{"start":{"line":49,"column":20},"end":{"line":49,"column":52}},"type":"binary-expr","locations":[{"start":{"line":49,"column":20},"end":{"line":49,"column":32}},{"start":{"line":49,"column":36},"end":{"line":49,"column":52}}],"line":49},"6":{"loc":{"start":{"line":54,"column":16},"end":{"line":54,"column":49}},"type":"binary-expr","locations":[{"start":{"line":54,"column":16},"end":{"line":54,"column":29}},{"start":{"line":54,"column":33},"end":{"line":54,"column":49}}],"line":54},"7":{"loc":{"start":{"line":60,"column":22},"end":{"line":60,"column":46}},"type":"binary-expr","locations":[{"start":{"line":60,"column":22},"end":{"line":60,"column":41}},{"start":{"line":60,"column":45},"end":{"line":60,"column":46}}],"line":60},"8":{"loc":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},{"start":{"line":65,"column":4},"end":{"line":67,"column":5}}],"line":65},"9":{"loc":{"start":{"line":66,"column":28},"end":{"line":66,"column":118}},"type":"binary-expr","locations":[{"start":{"line":66,"column":28},"end":{"line":66,"column":48}},{"start":{"line":66,"column":52},"end":{"line":66,"column":118}}],"line":66},"10":{"loc":{"start":{"line":76,"column":7},"end":{"line":76,"column":26}},"type":"binary-expr","locations":[{"start":{"line":76,"column":7},"end":{"line":76,"column":20}},{"start":{"line":76,"column":24},"end":{"line":76,"column":26}}],"line":76},"11":{"loc":{"start":{"line":83,"column":7},"end":{"line":83,"column":28}},"type":"binary-expr","locations":[{"start":{"line":83,"column":7},"end":{"line":83,"column":22}},{"start":{"line":83,"column":26},"end":{"line":83,"column":28}}],"line":83},"12":{"loc":{"start":{"line":87,"column":8},"end":{"line":102,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":102,"column":9}},{"start":{"line":87,"column":8},"end":{"line":102,"column":9}}],"line":87},"13":{"loc":{"start":{"line":92,"column":22},"end":{"line":92,"column":60}},"type":"binary-expr","locations":[{"start":{"line":92,"column":22},"end":{"line":92,"column":43}},{"start":{"line":92,"column":47},"end":{"line":92,"column":60}}],"line":92},"14":{"loc":{"start":{"line":99,"column":19},"end":{"line":99,"column":134}},"type":"cond-expr","locations":[{"start":{"line":99,"column":63},"end":{"line":99,"column":115}},{"start":{"line":99,"column":118},"end":{"line":99,"column":134}}],"line":99},"15":{"loc":{"start":{"line":99,"column":19},"end":{"line":99,"column":60}},"type":"binary-expr","locations":[{"start":{"line":99,"column":19},"end":{"line":99,"column":42}},{"start":{"line":99,"column":46},"end":{"line":99,"column":60}}],"line":99},"16":{"loc":{"start":{"line":99,"column":73},"end":{"line":99,"column":114}},"type":"binary-expr","locations":[{"start":{"line":99,"column":73},"end":{"line":99,"column":96}},{"start":{"line":99,"column":100},"end":{"line":99,"column":114}}],"line":99},"17":{"loc":{"start":{"line":100,"column":22},"end":{"line":100,"column":63}},"type":"binary-expr","locations":[{"start":{"line":100,"column":22},"end":{"line":100,"column":45}},{"start":{"line":100,"column":49},"end":{"line":100,"column":63}}],"line":100}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":17,"7":1,"8":1,"9":16,"10":22,"11":22,"12":20,"13":20,"14":1,"15":1,"16":19,"17":19,"18":1,"19":18,"20":16,"21":16,"22":30,"23":30,"24":16,"25":18,"26":18,"27":6,"28":12,"29":16,"30":1},"f":{"0":17,"1":1,"2":16,"3":22,"4":1,"5":19,"6":16,"7":30,"8":18},"b":{"0":[1,0],"1":[19,19],"2":[2,17],"3":[19,2],"4":[19,19],"5":[19,19],"6":[19,19],"7":[19,19],"8":[1,18],"9":[1,0],"10":[16,6],"11":[16,10],"12":[6,12],"13":[6,0],"14":[12,0],"15":[12,6],"16":[12,6],"17":[12,6]},"inputSourceMap":{"version":3,"sources":["sendAPN.js"],"names":["apn","require","R","DEFAULT_TTL","APN_METHOD","expiryFromTtl","ttl","Math","floor","Date","now","extractExpiry","cond","propIs","Number","prop","timeToLive","T","APN","constructor","settings","connection","Provider","e","connectionError","shutdown","sendAPN","regIds","data","message","Notification","retryLimit","retries","expiry","priority","encoding","payload","custom","badge","sound","alert","title","body","titleLocKey","titleLocArgs","locKey","locArgs","bodyLocArgs","launchImage","action","topic","category","clickAction","contentAvailable","mdm","urlArgs","truncateAtWordEnd","collapseId","collapseKey","mutableContent","threadId","pushType","Promise","reject","Error","send","then","response","resumed","method","success","failure","sent","forEach","token","push","regId","error","failed","device","errorMsg","reason","status","module","exports"],"mappings":"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","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["const apn = require('@parse/node-apn');\nconst R = require('ramda');\nconst { DEFAULT_TTL, APN_METHOD } = require('./constants');\n\nconst expiryFromTtl = ttl => ttl + Math.floor(Date.now() / 1000);\n\nconst extractExpiry = R.cond([\n  [R.propIs(Number, 'expiry'), R.prop('expiry')],\n  [\n    R.propIs(Number, 'timeToLive'),\n    ({ timeToLive }) => expiryFromTtl(timeToLive),\n  ],\n  [R.T, () => expiryFromTtl(DEFAULT_TTL)],\n]);\n\nclass APN {\n  constructor(settings) {\n    try {\n      this.connection = new apn.Provider(settings);\n    } catch (e) {\n      this.connectionError = e;\n      this.connection = null;\n    }\n  }\n\n  shutdown() {\n    if (this.connection) {\n      this.connection.shutdown();\n    }\n  }\n\n  sendAPN(regIds, data) {\n    const message = new apn.Notification({\n      retryLimit: data.retries || -1,\n      expiry: extractExpiry(data),\n      priority: data.priority === 'normal' ? 5 : 10,\n      encoding: data.encoding,\n      payload: data.custom || {},\n      badge: data.badge,\n      sound: data.sound,\n      alert: data.alert || {\n        title: data.title,\n        body: data.body,\n        'title-loc-key': data.titleLocKey,\n        'title-loc-args': data.titleLocArgs,\n        'loc-key': data.locKey,\n        // bodyLocArgs is kept for backward compatibility\n        'loc-args': data.locArgs || data.bodyLocArgs,\n        'launch-image': data.launchImage,\n        action: data.action,\n      },\n      topic: data.topic,\n      category: data.category || data.clickAction,\n      contentAvailable: data.contentAvailable,\n      mdm: data.mdm,\n      urlArgs: data.urlArgs,\n      truncateAtWordEnd: data.truncateAtWordEnd,\n      collapseId: data.collapseKey,\n      mutableContent: data.mutableContent || 0,\n      threadId: data.threadId,\n      pushType: data.pushType,\n    });\n\n    if (!this.connection) {\n      return Promise.reject(\n        this.connectionError ||\n          new Error('Unknown error: APN connection not configured properly')\n      );\n    }\n\n    return this.connection.send(message, regIds).then(response => {\n      const resumed = {\n        method: APN_METHOD,\n        success: 0,\n        failure: 0,\n        message: [],\n      };\n      (response.sent || []).forEach(token => {\n        resumed.success += 1;\n        resumed.message.push({\n          regId: token,\n          error: null,\n        });\n      });\n      (response.failed || []).forEach(failure => {\n        // See https://github.com/node-apn/node-apn/blob/master/doc/provider.markdown#failed\n        resumed.failure += 1;\n        if (failure.error) {\n          // A transport-level error occurred (e.g. network problem)\n          resumed.message.push({\n            regId: failure.device,\n            error: failure.error,\n            errorMsg: failure.error.message || failure.error,\n          });\n        } else {\n          // `failure.status` is the HTTP status code\n          // `failure.response` is the JSON payload\n          resumed.message.push({\n            regId: failure.device,\n            error:\n              failure.response.reason || failure.status\n                ? new Error(failure.response.reason || failure.status)\n                : failure.response,\n            errorMsg: failure.response.reason || failure.status,\n          });\n        }\n      });\n\n      return resumed;\n    });\n  }\n}\n\nmodule.exports = APN;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0cc6ddb710fb8d6124544c1a6bb423eb943c1e22","contentHash":"288d388567fcabe7175d8fbb8ad1dbbd25beef9c5d0d9826b695fb22bd1f7308"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendADM.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendADM.js","statementMap":{"0":{"start":{"line":3,"column":54},"end":{"line":3,"column":73}},"1":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"2":{"start":{"line":3,"column":125},"end":{"line":3,"column":161}},"3":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"4":{"start":{"line":3,"column":183},"end":{"line":3,"column":292}},"5":{"start":{"line":3,"column":225},"end":{"line":3,"column":288}},"6":{"start":{"line":3,"column":293},"end":{"line":3,"column":324}},"7":{"start":{"line":3,"column":327},"end":{"line":3,"column":339}},"8":{"start":{"line":5,"column":33},"end":{"line":5,"column":517}},"9":{"start":{"line":5,"column":46},"end":{"line":5,"column":47}},"10":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"11":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"12":{"start":{"line":5,"column":146},"end":{"line":5,"column":247}},"13":{"start":{"line":5,"column":201},"end":{"line":5,"column":243}},"14":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"15":{"start":{"line":5,"column":295},"end":{"line":5,"column":369}},"16":{"start":{"line":5,"column":379},"end":{"line":5,"column":513}},"17":{"start":{"line":5,"column":428},"end":{"line":5,"column":509}},"18":{"start":{"line":5,"column":518},"end":{"line":5,"column":532}},"19":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"20":{"start":{"line":7,"column":62},"end":{"line":7,"column":166}},"21":{"start":{"line":7,"column":176},"end":{"line":7,"column":193}},"22":{"start":{"line":7,"column":196},"end":{"line":7,"column":207}},"23":{"start":{"line":9,"column":12},"end":{"line":9,"column":31}},"24":{"start":{"line":11,"column":17},"end":{"line":11,"column":39}},"25":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"26":{"start":{"line":14,"column":16},"end":{"line":52,"column":1}},"27":{"start":{"line":15,"column":18},"end":{"line":20,"column":3}},"28":{"start":{"line":21,"column":19},"end":{"line":21,"column":21}},"29":{"start":{"line":22,"column":20},"end":{"line":22,"column":48}},"30":{"start":{"line":24,"column":15},"end":{"line":24,"column":39}},"31":{"start":{"line":26,"column":27},"end":{"line":26,"column":48}},"32":{"start":{"line":27,"column":17},"end":{"line":27,"column":28}},"33":{"start":{"line":28,"column":21},"end":{"line":28,"column":36}},"34":{"start":{"line":29,"column":2},"end":{"line":29,"column":31}},"35":{"start":{"line":30,"column":2},"end":{"line":30,"column":21}},"36":{"start":{"line":31,"column":2},"end":{"line":31,"column":25}},"37":{"start":{"line":32,"column":18},"end":{"line":36,"column":3}},"38":{"start":{"line":37,"column":2},"end":{"line":50,"column":5}},"39":{"start":{"line":38,"column":4},"end":{"line":49,"column":7}},"40":{"start":{"line":39,"column":23},"end":{"line":39,"column":74}},"41":{"start":{"line":40,"column":20},"end":{"line":40,"column":78}},"42":{"start":{"line":41,"column":6},"end":{"line":41,"column":39}},"43":{"start":{"line":42,"column":6},"end":{"line":42,"column":39}},"44":{"start":{"line":43,"column":6},"end":{"line":47,"column":9}},"45":{"start":{"line":48,"column":6},"end":{"line":48,"column":39}},"46":{"start":{"line":51,"column":2},"end":{"line":51,"column":51}},"47":{"start":{"line":51,"column":42},"end":{"line":51,"column":49}},"48":{"start":{"line":54,"column":0},"end":{"line":54,"column":25}}},"fnMap":{"0":{"name":"ownKeys","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":41},"end":{"line":3,"column":341}},"line":3},"1":{"name":"(anonymous_1)","decl":{"start":{"line":3,"column":208},"end":{"line":3,"column":209}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":290}},"line":3},"2":{"name":"_objectSpread","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":22}},"loc":{"start":{"line":5,"column":31},"end":{"line":5,"column":534}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":5,"column":184},"end":{"line":5,"column":185}},"loc":{"start":{"line":5,"column":199},"end":{"line":5,"column":245}},"line":5},"4":{"name":"(anonymous_4)","decl":{"start":{"line":5,"column":411},"end":{"line":5,"column":412}},"loc":{"start":{"line":5,"column":426},"end":{"line":5,"column":511}},"line":5},"5":{"name":"_defineProperty","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":24}},"loc":{"start":{"line":7,"column":42},"end":{"line":7,"column":209}},"line":7},"6":{"name":"(anonymous_6)","decl":{"start":{"line":14,"column":16},"end":{"line":14,"column":17}},"loc":{"start":{"line":14,"column":45},"end":{"line":52,"column":1}},"line":14},"7":{"name":"(anonymous_7)","decl":{"start":{"line":37,"column":17},"end":{"line":37,"column":18}},"loc":{"start":{"line":37,"column":26},"end":{"line":50,"column":3}},"line":37},"8":{"name":"(anonymous_8)","decl":{"start":{"line":38,"column":35},"end":{"line":38,"column":36}},"loc":{"start":{"line":38,"column":54},"end":{"line":49,"column":5}},"line":38},"9":{"name":"(anonymous_9)","decl":{"start":{"line":51,"column":36},"end":{"line":51,"column":37}},"loc":{"start":{"line":51,"column":42},"end":{"line":51,"column":49}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"type":"if","locations":[{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},{"start":{"line":3,"column":75},"end":{"line":3,"column":326}}],"line":3},"1":{"loc":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"type":"if","locations":[{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},{"start":{"line":3,"column":163},"end":{"line":3,"column":292}}],"line":3},"2":{"loc":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"type":"cond-expr","locations":[{"start":{"line":5,"column":114},"end":{"line":5,"column":126}},{"start":{"line":5,"column":129},"end":{"line":5,"column":131}}],"line":5},"3":{"loc":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},{"start":{"line":5,"column":133},"end":{"line":5,"column":515}}],"line":5},"4":{"loc":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},{"start":{"line":5,"column":255},"end":{"line":5,"column":515}}],"line":5},"5":{"loc":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"type":"if","locations":[{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},{"start":{"line":7,"column":44},"end":{"line":7,"column":195}}],"line":7},"6":{"loc":{"start":{"line":33,"column":18},"end":{"line":33,"column":84}},"type":"binary-expr","locations":[{"start":{"line":33,"column":18},"end":{"line":33,"column":56}},{"start":{"line":33,"column":60},"end":{"line":33,"column":70}},{"start":{"line":33,"column":74},"end":{"line":33,"column":84}}],"line":33},"7":{"loc":{"start":{"line":39,"column":23},"end":{"line":39,"column":74}},"type":"cond-expr","locations":[{"start":{"line":39,"column":46},"end":{"line":39,"column":57}},{"start":{"line":39,"column":60},"end":{"line":39,"column":74}}],"line":39},"8":{"loc":{"start":{"line":40,"column":20},"end":{"line":40,"column":78}},"type":"binary-expr","locations":[{"start":{"line":40,"column":20},"end":{"line":40,"column":23}},{"start":{"line":40,"column":28},"end":{"line":40,"column":77}}],"line":40},"9":{"loc":{"start":{"line":40,"column":28},"end":{"line":40,"column":77}},"type":"cond-expr","locations":[{"start":{"line":40,"column":45},"end":{"line":40,"column":70}},{"start":{"line":40,"column":73},"end":{"line":40,"column":77}}],"line":40},"10":{"loc":{"start":{"line":41,"column":25},"end":{"line":41,"column":38}},"type":"cond-expr","locations":[{"start":{"line":41,"column":33},"end":{"line":41,"column":34}},{"start":{"line":41,"column":37},"end":{"line":41,"column":38}}],"line":41},"11":{"loc":{"start":{"line":42,"column":25},"end":{"line":42,"column":38}},"type":"cond-expr","locations":[{"start":{"line":42,"column":33},"end":{"line":42,"column":34}},{"start":{"line":42,"column":37},"end":{"line":42,"column":38}}],"line":42}},"s":{"0":8,"1":8,"2":8,"3":8,"4":8,"5":0,"6":8,"7":8,"8":8,"9":8,"10":8,"11":8,"12":8,"13":32,"14":0,"15":0,"16":0,"17":0,"18":8,"19":32,"20":0,"21":32,"22":32,"23":1,"24":1,"25":1,"26":1,"27":8,"28":8,"29":8,"30":8,"31":8,"32":8,"33":8,"34":8,"35":8,"36":8,"37":8,"38":8,"39":20,"40":18,"41":18,"42":18,"43":18,"44":18,"45":18,"46":6,"47":6,"48":1},"f":{"0":8,"1":0,"2":8,"3":32,"4":0,"5":32,"6":8,"7":20,"8":18,"9":6},"b":{"0":[8,0],"1":[8,0],"2":[8,0],"3":[8,0],"4":[0,0],"5":[0,32],"6":[8,8,8],"7":[6,12],"8":[18,12],"9":[6,6],"10":[12,6],"11":[12,6]},"inputSourceMap":{"version":3,"sources":["sendADM.js"],"names":["adm","require","ADM_METHOD","sendADM","regIds","_data","settings","resumed","method","success","failure","message","promises","admSender","Sender","data","consolidationKey","expiry","timeToLive","expiresAfter","Math","floor","Date","now","forEach","regId","send","err","response","errorMsg","Error","error","push","Promise","resolve","all","then","module","exports"],"mappings":";;;;;;;;AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,UAAD,CAAnB;;iBACuBA,OAAO,CAAC,aAAD,C;MAAtBC,U,YAAAA,U;;AAER,MAAMC,OAAO,GAAG,CAACC,MAAD,EAASC,KAAT,EAAgBC,QAAhB,KAA6B;AAC3C,QAAMC,OAAO,GAAG;AACdC,IAAAA,MAAM,EAAEN,UADM;AAEdO,IAAAA,OAAO,EAAE,CAFK;AAGdC,IAAAA,OAAO,EAAE,CAHK;AAIdC,IAAAA,OAAO,EAAE;AAJK,GAAhB;AAMA,QAAMC,QAAQ,GAAG,EAAjB;AACA,QAAMC,SAAS,GAAG,IAAIb,GAAG,CAACc,MAAR,CAAeR,QAAQ,CAACN,GAAxB,CAAlB;;AACA,QAAMe,IAAI,qBAAQV,KAAR,CAAV;;AAT2C,QAUnCW,gBAVmC,GAUMD,IAVN,CAUnCC,gBAVmC;AAAA,QAUjBC,MAViB,GAUMF,IAVN,CAUjBE,MAViB;AAAA,QAUTC,UAVS,GAUMH,IAVN,CAUTG,UAVS;AAY3C,SAAOH,IAAI,CAACC,gBAAZ;AACA,SAAOD,IAAI,CAACE,MAAZ;AACA,SAAOF,IAAI,CAACG,UAAZ;AAEA,QAAMP,OAAO,GAAG;AACdQ,IAAAA,YAAY,EACVF,MAAM,GAAGG,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACC,GAAL,KAAa,IAAxB,CAAT,IAA0CL,UAA1C,IAAwD,KAAK,KAFjD;AAGdF,IAAAA,gBAHc;AAIdD,IAAAA;AAJc,GAAhB;AAOAX,EAAAA,MAAM,CAACoB,OAAP,CAAeC,KAAK,IAAI;AACtBZ,IAAAA,SAAS,CAACa,IAAV,CAAef,OAAf,EAAwBc,KAAxB,EAA+B,CAACE,GAAD,EAAMC,QAAN,KAAmB;AAChD,YAAMC,QAAQ,GAAGF,GAAG,YAAYG,KAAf,GAAuBH,GAAG,CAAChB,OAA3B,GAAqCiB,QAAQ,CAACG,KAA/D;AACA,YAAMA,KAAK,GAAGJ,GAAG,KAAKC,QAAQ,CAACG,KAAT,GAAiB,IAAID,KAAJ,CAAUF,QAAQ,CAACG,KAAnB,CAAjB,GAA6C,IAAlD,CAAjB;AACAxB,MAAAA,OAAO,CAACE,OAAR,IAAmBsB,KAAK,GAAG,CAAH,GAAO,CAA/B;AACAxB,MAAAA,OAAO,CAACG,OAAR,IAAmBqB,KAAK,GAAG,CAAH,GAAO,CAA/B;AACAxB,MAAAA,OAAO,CAACI,OAAR,CAAgBqB,IAAhB,CAAqB;AACnBP,QAAAA,KADmB;AAEnBM,QAAAA,KAFmB;AAGnBF,QAAAA;AAHmB,OAArB;AAKAjB,MAAAA,QAAQ,CAACoB,IAAT,CAAcC,OAAO,CAACC,OAAR,EAAd;AACD,KAXD;AAYD,GAbD;AAeA,SAAOD,OAAO,CAACE,GAAR,CAAYvB,QAAZ,EAAsBwB,IAAtB,CAA2B,MAAM7B,OAAjC,CAAP;AACD,CAvCD;;AAyCA8B,MAAM,CAACC,OAAP,GAAiBnC,OAAjB","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["const adm = require('node-adm');\nconst { ADM_METHOD } = require('./constants');\n\nconst sendADM = (regIds, _data, settings) => {\n  const resumed = {\n    method: ADM_METHOD,\n    success: 0,\n    failure: 0,\n    message: [],\n  };\n  const promises = [];\n  const admSender = new adm.Sender(settings.adm);\n  const data = { ..._data };\n  const { consolidationKey, expiry, timeToLive } = data;\n\n  delete data.consolidationKey;\n  delete data.expiry;\n  delete data.timeToLive;\n\n  const message = {\n    expiresAfter:\n      expiry - Math.floor(Date.now() / 1000) || timeToLive || 28 * 86400,\n    consolidationKey,\n    data,\n  };\n\n  regIds.forEach(regId => {\n    admSender.send(message, regId, (err, response) => {\n      const errorMsg = err instanceof Error ? err.message : response.error;\n      const error = err || (response.error ? new Error(response.error) : null);\n      resumed.success += error ? 0 : 1;\n      resumed.failure += error ? 1 : 0;\n      resumed.message.push({\n        regId,\n        error,\n        errorMsg,\n      });\n      promises.push(Promise.resolve());\n    });\n  });\n\n  return Promise.all(promises).then(() => resumed);\n};\n\nmodule.exports = sendADM;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b5599062b80f02567b2fd7fc72f7970aff2aa765","contentHash":"3ad25a443756058b619fd2fc69266e61ccc32fa42e3795100600b5e82f2d9cb3"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendWNS.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendWNS.js","statementMap":{"0":{"start":{"line":3,"column":54},"end":{"line":3,"column":73}},"1":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"2":{"start":{"line":3,"column":125},"end":{"line":3,"column":161}},"3":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"4":{"start":{"line":3,"column":183},"end":{"line":3,"column":292}},"5":{"start":{"line":3,"column":225},"end":{"line":3,"column":288}},"6":{"start":{"line":3,"column":293},"end":{"line":3,"column":324}},"7":{"start":{"line":3,"column":327},"end":{"line":3,"column":339}},"8":{"start":{"line":5,"column":33},"end":{"line":5,"column":517}},"9":{"start":{"line":5,"column":46},"end":{"line":5,"column":47}},"10":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"11":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"12":{"start":{"line":5,"column":146},"end":{"line":5,"column":247}},"13":{"start":{"line":5,"column":201},"end":{"line":5,"column":243}},"14":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"15":{"start":{"line":5,"column":295},"end":{"line":5,"column":369}},"16":{"start":{"line":5,"column":379},"end":{"line":5,"column":513}},"17":{"start":{"line":5,"column":428},"end":{"line":5,"column":509}},"18":{"start":{"line":5,"column":518},"end":{"line":5,"column":532}},"19":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"20":{"start":{"line":7,"column":62},"end":{"line":7,"column":166}},"21":{"start":{"line":7,"column":176},"end":{"line":7,"column":193}},"22":{"start":{"line":7,"column":196},"end":{"line":7,"column":207}},"23":{"start":{"line":9,"column":12},"end":{"line":9,"column":26}},"24":{"start":{"line":11,"column":17},"end":{"line":11,"column":39}},"25":{"start":{"line":12,"column":19},"end":{"line":12,"column":38}},"26":{"start":{"line":14,"column":26},"end":{"line":14,"column":73}},"27":{"start":{"line":14,"column":33},"end":{"line":14,"column":73}},"28":{"start":{"line":16,"column":19},"end":{"line":26,"column":1}},"29":{"start":{"line":17,"column":2},"end":{"line":19,"column":3}},"30":{"start":{"line":18,"column":4},"end":{"line":18,"column":15}},"31":{"start":{"line":21,"column":2},"end":{"line":23,"column":3}},"32":{"start":{"line":22,"column":4},"end":{"line":22,"column":26}},"33":{"start":{"line":25,"column":2},"end":{"line":25,"column":14}},"34":{"start":{"line":31,"column":16},"end":{"line":31,"column":66}},"35":{"start":{"line":32,"column":19},"end":{"line":32,"column":83}},"36":{"start":{"line":33,"column":2},"end":{"line":33,"column":35}},"37":{"start":{"line":34,"column":2},"end":{"line":34,"column":35}},"38":{"start":{"line":35,"column":2},"end":{"line":39,"column":5}},"39":{"start":{"line":42,"column":16},"end":{"line":102,"column":1}},"40":{"start":{"line":48,"column":18},"end":{"line":48,"column":32}},"41":{"start":{"line":50,"column":4},"end":{"line":65,"column":5}},"42":{"start":{"line":51,"column":6},"end":{"line":62,"column":7}},"43":{"start":{"line":52,"column":8},"end":{"line":58,"column":11}},"44":{"start":{"line":53,"column":10},"end":{"line":53,"column":47}},"45":{"start":{"line":54,"column":10},"end":{"line":54,"column":48}},"46":{"start":{"line":55,"column":10},"end":{"line":57,"column":24}},"47":{"start":{"line":60,"column":8},"end":{"line":60,"column":47}},"48":{"start":{"line":61,"column":8},"end":{"line":61,"column":76}},"49":{"start":{"line":64,"column":6},"end":{"line":64,"column":65}},"50":{"start":{"line":64,"column":43},"end":{"line":64,"column":53}},"51":{"start":{"line":68,"column":19},"end":{"line":68,"column":21}},"52":{"start":{"line":70,"column":15},"end":{"line":70,"column":46}},"53":{"start":{"line":72,"column":29},"end":{"line":72,"column":52}},"54":{"start":{"line":73,"column":15},"end":{"line":73,"column":98}},"55":{"start":{"line":74,"column":2},"end":{"line":79,"column":4}},"56":{"start":{"line":80,"column":2},"end":{"line":80,"column":46}},"57":{"start":{"line":81,"column":2},"end":{"line":81,"column":43}},"58":{"start":{"line":82,"column":2},"end":{"line":82,"column":49}},"59":{"start":{"line":83,"column":2},"end":{"line":83,"column":33}},"60":{"start":{"line":84,"column":2},"end":{"line":84,"column":22}},"61":{"start":{"line":85,"column":2},"end":{"line":85,"column":21}},"62":{"start":{"line":86,"column":2},"end":{"line":86,"column":23}},"63":{"start":{"line":88,"column":2},"end":{"line":99,"column":3}},"64":{"start":{"line":89,"column":4},"end":{"line":89,"column":22}},"65":{"start":{"line":90,"column":19},"end":{"line":90,"column":31}},"66":{"start":{"line":92,"column":4},"end":{"line":92,"column":149}},"67":{"start":{"line":92,"column":51},"end":{"line":92,"column":146}},"68":{"start":{"line":92,"column":116},"end":{"line":92,"column":145}},"69":{"start":{"line":95,"column":4},"end":{"line":98,"column":10}},"70":{"start":{"line":95,"column":29},"end":{"line":98,"column":8}},"71":{"start":{"line":95,"column":66},"end":{"line":98,"column":6}},"72":{"start":{"line":96,"column":6},"end":{"line":96,"column":44}},"73":{"start":{"line":97,"column":6},"end":{"line":97,"column":16}},"74":{"start":{"line":101,"column":2},"end":{"line":101,"column":51}},"75":{"start":{"line":101,"column":42},"end":{"line":101,"column":49}},"76":{"start":{"line":104,"column":0},"end":{"line":104,"column":25}}},"fnMap":{"0":{"name":"ownKeys","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":41},"end":{"line":3,"column":341}},"line":3},"1":{"name":"(anonymous_1)","decl":{"start":{"line":3,"column":208},"end":{"line":3,"column":209}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":290}},"line":3},"2":{"name":"_objectSpread","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":22}},"loc":{"start":{"line":5,"column":31},"end":{"line":5,"column":534}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":5,"column":184},"end":{"line":5,"column":185}},"loc":{"start":{"line":5,"column":199},"end":{"line":5,"column":245}},"line":5},"4":{"name":"(anonymous_4)","decl":{"start":{"line":5,"column":411},"end":{"line":5,"column":412}},"loc":{"start":{"line":5,"column":426},"end":{"line":5,"column":511}},"line":5},"5":{"name":"_defineProperty","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":24}},"loc":{"start":{"line":7,"column":42},"end":{"line":7,"column":209}},"line":7},"6":{"name":"(anonymous_6)","decl":{"start":{"line":14,"column":26},"end":{"line":14,"column":27}},"loc":{"start":{"line":14,"column":33},"end":{"line":14,"column":73}},"line":14},"7":{"name":"(anonymous_7)","decl":{"start":{"line":16,"column":19},"end":{"line":16,"column":20}},"loc":{"start":{"line":16,"column":26},"end":{"line":26,"column":1}},"line":16},"8":{"name":"processResponse","decl":{"start":{"line":30,"column":9},"end":{"line":30,"column":24}},"loc":{"start":{"line":30,"column":47},"end":{"line":40,"column":1}},"line":30},"9":{"name":"(anonymous_9)","decl":{"start":{"line":42,"column":16},"end":{"line":42,"column":17}},"loc":{"start":{"line":42,"column":46},"end":{"line":102,"column":1}},"line":42},"10":{"name":"sendNotifications","decl":{"start":{"line":47,"column":11},"end":{"line":47,"column":28}},"loc":{"start":{"line":47,"column":79},"end":{"line":66,"column":3}},"line":47},"11":{"name":"(anonymous_11)","decl":{"start":{"line":52,"column":51},"end":{"line":52,"column":52}},"loc":{"start":{"line":52,"column":70},"end":{"line":58,"column":9}},"line":52},"12":{"name":"(anonymous_12)","decl":{"start":{"line":64,"column":37},"end":{"line":64,"column":38}},"loc":{"start":{"line":64,"column":43},"end":{"line":64,"column":53}},"line":64},"13":{"name":"(anonymous_13)","decl":{"start":{"line":92,"column":30},"end":{"line":92,"column":31}},"loc":{"start":{"line":92,"column":51},"end":{"line":92,"column":146}},"line":92},"14":{"name":"(anonymous_14)","decl":{"start":{"line":92,"column":109},"end":{"line":92,"column":110}},"loc":{"start":{"line":92,"column":116},"end":{"line":92,"column":145}},"line":92},"15":{"name":"(anonymous_15)","decl":{"start":{"line":95,"column":20},"end":{"line":95,"column":21}},"loc":{"start":{"line":95,"column":29},"end":{"line":98,"column":8}},"line":95},"16":{"name":"(anonymous_16)","decl":{"start":{"line":95,"column":55},"end":{"line":95,"column":56}},"loc":{"start":{"line":95,"column":66},"end":{"line":98,"column":6}},"line":95},"17":{"name":"(anonymous_17)","decl":{"start":{"line":95,"column":109},"end":{"line":95,"column":110}},"loc":{"start":{"line":95,"column":128},"end":{"line":98,"column":5}},"line":95},"18":{"name":"(anonymous_18)","decl":{"start":{"line":101,"column":36},"end":{"line":101,"column":37}},"loc":{"start":{"line":101,"column":42},"end":{"line":101,"column":49}},"line":101}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},"type":"if","locations":[{"start":{"line":3,"column":75},"end":{"line":3,"column":326}},{"start":{"line":3,"column":75},"end":{"line":3,"column":326}}],"line":3},"1":{"loc":{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},"type":"if","locations":[{"start":{"line":3,"column":163},"end":{"line":3,"column":292}},{"start":{"line":3,"column":163},"end":{"line":3,"column":292}}],"line":3},"2":{"loc":{"start":{"line":5,"column":91},"end":{"line":5,"column":131}},"type":"cond-expr","locations":[{"start":{"line":5,"column":114},"end":{"line":5,"column":126}},{"start":{"line":5,"column":129},"end":{"line":5,"column":131}}],"line":5},"3":{"loc":{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":133},"end":{"line":5,"column":515}},{"start":{"line":5,"column":133},"end":{"line":5,"column":515}}],"line":5},"4":{"loc":{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},"type":"if","locations":[{"start":{"line":5,"column":255},"end":{"line":5,"column":515}},{"start":{"line":5,"column":255},"end":{"line":5,"column":515}}],"line":5},"5":{"loc":{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},"type":"if","locations":[{"start":{"line":7,"column":44},"end":{"line":7,"column":195}},{"start":{"line":7,"column":44},"end":{"line":7,"column":195}}],"line":7},"6":{"loc":{"start":{"line":14,"column":33},"end":{"line":14,"column":73}},"type":"cond-expr","locations":[{"start":{"line":14,"column":56},"end":{"line":14,"column":67}},{"start":{"line":14,"column":70},"end":{"line":14,"column":73}}],"line":14},"7":{"loc":{"start":{"line":17,"column":2},"end":{"line":19,"column":3}},"type":"if","locations":[{"start":{"line":17,"column":2},"end":{"line":19,"column":3}},{"start":{"line":17,"column":2},"end":{"line":19,"column":3}}],"line":17},"8":{"loc":{"start":{"line":21,"column":2},"end":{"line":23,"column":3}},"type":"if","locations":[{"start":{"line":21,"column":2},"end":{"line":23,"column":3}},{"start":{"line":21,"column":2},"end":{"line":23,"column":3}}],"line":21},"9":{"loc":{"start":{"line":31,"column":16},"end":{"line":31,"column":66}},"type":"binary-expr","locations":[{"start":{"line":31,"column":16},"end":{"line":31,"column":31}},{"start":{"line":31,"column":35},"end":{"line":31,"column":66}}],"line":31},"10":{"loc":{"start":{"line":32,"column":19},"end":{"line":32,"column":83}},"type":"binary-expr","locations":[{"start":{"line":32,"column":19},"end":{"line":32,"column":41}},{"start":{"line":32,"column":45},"end":{"line":32,"column":83}}],"line":32},"11":{"loc":{"start":{"line":33,"column":21},"end":{"line":33,"column":34}},"type":"cond-expr","locations":[{"start":{"line":33,"column":29},"end":{"line":33,"column":30}},{"start":{"line":33,"column":33},"end":{"line":33,"column":34}}],"line":33},"12":{"loc":{"start":{"line":34,"column":21},"end":{"line":34,"column":34}},"type":"cond-expr","locations":[{"start":{"line":34,"column":29},"end":{"line":34,"column":30}},{"start":{"line":34,"column":33},"end":{"line":34,"column":34}}],"line":34},"13":{"loc":{"start":{"line":50,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":65,"column":5}},{"start":{"line":50,"column":4},"end":{"line":65,"column":5}}],"line":50},"14":{"loc":{"start":{"line":73,"column":15},"end":{"line":73,"column":98}},"type":"cond-expr","locations":[{"start":{"line":73,"column":50},"end":{"line":73,"column":71}},{"start":{"line":73,"column":74},"end":{"line":73,"column":98}}],"line":73},"15":{"loc":{"start":{"line":80,"column":17},"end":{"line":80,"column":45}},"type":"binary-expr","locations":[{"start":{"line":80,"column":17},"end":{"line":80,"column":29}},{"start":{"line":80,"column":33},"end":{"line":80,"column":45}}],"line":80},"16":{"loc":{"start":{"line":81,"column":16},"end":{"line":81,"column":42}},"type":"binary-expr","locations":[{"start":{"line":81,"column":16},"end":{"line":81,"column":27}},{"start":{"line":81,"column":31},"end":{"line":81,"column":42}}],"line":81},"17":{"loc":{"start":{"line":82,"column":18},"end":{"line":82,"column":48}},"type":"binary-expr","locations":[{"start":{"line":82,"column":18},"end":{"line":82,"column":31}},{"start":{"line":82,"column":35},"end":{"line":82,"column":48}}],"line":82},"18":{"loc":{"start":{"line":88,"column":2},"end":{"line":99,"column":3}},"type":"if","locations":[{"start":{"line":88,"column":2},"end":{"line":99,"column":3}},{"start":{"line":88,"column":2},"end":{"line":99,"column":3}}],"line":88},"19":{"loc":{"start":{"line":92,"column":116},"end":{"line":92,"column":145}},"type":"cond-expr","locations":[{"start":{"line":92,"column":122},"end":{"line":92,"column":133}},{"start":{"line":92,"column":136},"end":{"line":92,"column":145}}],"line":92}},"s":{"0":41,"1":41,"2":41,"3":41,"4":41,"5":0,"6":41,"7":41,"8":41,"9":41,"10":53,"11":53,"12":41,"13":161,"14":12,"15":12,"16":0,"17":0,"18":41,"19":161,"20":0,"21":161,"22":161,"23":1,"24":1,"25":1,"26":1,"27":60,"28":1,"29":60,"30":6,"31":54,"32":12,"33":42,"34":33,"35":33,"36":33,"37":33,"38":33,"39":1,"40":24,"41":24,"42":18,"43":18,"44":12,"45":12,"46":12,"47":6,"48":6,"49":6,"50":4,"51":15,"52":15,"53":15,"54":15,"55":15,"56":15,"57":15,"58":15,"59":15,"60":15,"61":15,"62":15,"63":15,"64":6,"65":6,"66":6,"67":6,"68":6,"69":9,"70":27,"71":27,"72":21,"73":21,"74":15,"75":11,"76":1},"f":{"0":41,"1":0,"2":41,"3":161,"4":0,"5":161,"6":60,"7":60,"8":33,"9":15,"10":24,"11":12,"12":4,"13":6,"14":6,"15":27,"16":27,"17":21,"18":11},"b":{"0":[41,0],"1":[41,0],"2":[53,0],"3":[41,12],"4":[12,0],"5":[0,161],"6":[6,54],"7":[6,54],"8":[12,42],"9":[33,27],"10":[33,27],"11":[18,15],"12":[18,15],"13":[18,6],"14":[1,14],"15":[15,15],"16":[15,15],"17":[15,15],"18":[6,9],"19":[2,4]},"inputSourceMap":{"version":3,"sources":["sendWNS.js"],"names":["wns","require","WNS_METHOD","parseErrorMessage","err","Error","message","parseError","resumed","processResponse","response","regId","error","innerError","errorMsg","success","failure","push","sendWNS","_regIds","_data","settings","sendPromises","sendNotifications","regIds","notificationMethod","data","opts","onFinish","shift","Promise","resolve","accessToken","newAccessToken","reject","all","then","promises","JSON","stringify","method","headers","launch","duration","forEach","module","exports"],"mappings":"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","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["const wns = require('wns');\nconst { WNS_METHOD } = require('./constants');\n\nconst parseErrorMessage = err => (err instanceof Error ? err.message : err);\nconst parseError = err => {\n  if (err instanceof Error) {\n    return err;\n  }\n  if (err) {\n    return new Error(err);\n  }\n  return null;\n};\n\nlet resumed;\n\nfunction processResponse(err, response, regId) {\n  const error = parseError(err) || parseError(response.innerError);\n  const errorMsg =\n    parseErrorMessage(err) || parseErrorMessage(response.innerError);\n  resumed.success += error ? 0 : 1;\n  resumed.failure += error ? 1 : 0;\n  resumed.message.push({\n    regId,\n    error,\n    errorMsg,\n  });\n}\n\nconst sendWNS = (_regIds, _data, settings) => {\n  // sendNotifications and sendPromises are inside exports as in this way,\n  // successive calls to this module doesn't override previous ones\n  let sendPromises;\n\n  function sendNotifications(regIds, notificationMethod, data, opts, onFinish) {\n    const regId = regIds.shift();\n    if (regId) {\n      try {\n        wns[notificationMethod](regId, data, opts, (err, response) => {\n          sendPromises.push(Promise.resolve());\n          processResponse(err, response, regId);\n          sendNotifications(\n            regIds,\n            notificationMethod,\n            data,\n            { ...opts, accessToken: response.newAccessToken },\n            onFinish\n          );\n        });\n      } catch (err) {\n        sendPromises.push(Promise.reject(err));\n        sendNotifications(regIds, notificationMethod, data, opts, onFinish);\n      }\n    } else {\n      Promise.all(sendPromises).then(() => onFinish(), onFinish);\n    }\n  }\n\n  const promises = [];\n  const opts = { ...settings.wns };\n  const { notificationMethod } = opts;\n  const data =\n    notificationMethod === 'sendRaw' ? JSON.stringify(_data) : { ..._data };\n\n  resumed = {\n    method: WNS_METHOD,\n    success: 0,\n    failure: 0,\n    message: [],\n  };\n  opts.headers = data.headers || opts.headers;\n  opts.launch = data.launch || opts.launch;\n  opts.duration = data.duration || opts.duration;\n\n  delete opts.notificationMethod;\n  delete data.headers;\n  delete data.launch;\n  delete data.duration;\n\n  if (opts.accessToken) {\n    sendPromises = [];\n    const regIds = [..._regIds];\n    // eslint-disable-next-line max-len\n    promises.push(\n      new Promise((resolve, reject) =>\n        sendNotifications(regIds, notificationMethod, data, opts, err =>\n          err ? reject(err) : resolve()\n        )\n      )\n    );\n  } else {\n    // eslint-disable-next-line max-len\n    _regIds.forEach(regId =>\n      promises.push(\n        new Promise(resolve =>\n          wns[notificationMethod](regId, data, opts, (err, response) => {\n            processResponse(err, response, regId);\n            resolve();\n          })\n        )\n      )\n    );\n  }\n\n  return Promise.all(promises).then(() => resumed);\n};\n\nmodule.exports = sendWNS;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3895396fef8a5ad5f7b9ff26475da769e7e259e8","contentHash":"9635eea7f7050db38ccc3952418780490beace28fb61363aad153783c7e00330"},"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendWeb.js":{"path":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src/sendWeb.js","statementMap":{"0":{"start":{"line":3,"column":77},"end":{"line":3,"column":175}},"1":{"start":{"line":3,"column":94},"end":{"line":3,"column":107}},"2":{"start":{"line":3,"column":121},"end":{"line":3,"column":131}},"3":{"start":{"line":3,"column":151},"end":{"line":3,"column":165}},"4":{"start":{"line":3,"column":166},"end":{"line":3,"column":173}},"5":{"start":{"line":3,"column":176},"end":{"line":3,"column":263}},"6":{"start":{"line":3,"column":193},"end":{"line":3,"column":208}},"7":{"start":{"line":3,"column":218},"end":{"line":3,"column":261}},"8":{"start":{"line":5,"column":33},"end":{"line":5,"column":387}},"9":{"start":{"line":5,"column":65},"end":{"line":5,"column":69}},"10":{"start":{"line":5,"column":78},"end":{"line":5,"column":87}},"11":{"start":{"line":5,"column":89},"end":{"line":5,"column":384}},"12":{"start":{"line":5,"column":147},"end":{"line":5,"column":167}},"13":{"start":{"line":5,"column":193},"end":{"line":5,"column":264}},"14":{"start":{"line":5,"column":290},"end":{"line":5,"column":360}},"15":{"start":{"line":5,"column":363},"end":{"line":5,"column":380}},"16":{"start":{"line":7,"column":16},"end":{"line":7,"column":35}},"17":{"start":{"line":9,"column":17},"end":{"line":9,"column":33}},"18":{"start":{"line":10,"column":11},"end":{"line":10,"column":22}},"19":{"start":{"line":11,"column":15},"end":{"line":11,"column":30}},"20":{"start":{"line":12,"column":14},"end":{"line":12,"column":28}},"21":{"start":{"line":14,"column":18},"end":{"line":14,"column":40}},"22":{"start":{"line":15,"column":19},"end":{"line":15,"column":39}},"23":{"start":{"line":17,"column":18},"end":{"line":17,"column":52}},"24":{"start":{"line":21,"column":0},"end":{"line":52,"column":3}},"25":{"start":{"line":22,"column":13},"end":{"line":47,"column":4}},"26":{"start":{"line":23,"column":20},"end":{"line":23,"column":35}},"27":{"start":{"line":24,"column":21},"end":{"line":39,"column":8}},"28":{"start":{"line":24,"column":41},"end":{"line":39,"column":7}},"29":{"start":{"line":24,"column":108},"end":{"line":31,"column":5}},"30":{"start":{"line":31,"column":22},"end":{"line":39,"column":5}},"31":{"start":{"line":40,"column":20},"end":{"line":40,"column":47}},"32":{"start":{"line":41,"column":20},"end":{"line":45,"column":7}},"33":{"start":{"line":41,"column":54},"end":{"line":45,"column":5}},"34":{"start":{"line":46,"column":4},"end":{"line":46,"column":48}},"35":{"start":{"line":49,"column":2},"end":{"line":51,"column":4}},"36":{"start":{"line":50,"column":4},"end":{"line":50,"column":39}},"37":{"start":{"line":54,"column":0},"end":{"line":54,"column":29}}},"fnMap":{"0":{"name":"asyncGeneratorStep","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":27}},"loc":{"start":{"line":3,"column":75},"end":{"line":3,"column":265}},"line":3},"1":{"name":"_asyncToGenerator","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":26}},"loc":{"start":{"line":5,"column":31},"end":{"line":5,"column":389}},"line":5},"2":{"name":"(anonymous_2)","decl":{"start":{"line":5,"column":40},"end":{"line":5,"column":41}},"loc":{"start":{"line":5,"column":52},"end":{"line":5,"column":386}},"line":5},"3":{"name":"(anonymous_3)","decl":{"start":{"line":5,"column":108},"end":{"line":5,"column":109}},"loc":{"start":{"line":5,"column":135},"end":{"line":5,"column":382}},"line":5},"4":{"name":"_next","decl":{"start":{"line":5,"column":178},"end":{"line":5,"column":183}},"loc":{"start":{"line":5,"column":191},"end":{"line":5,"column":266}},"line":5},"5":{"name":"_throw","decl":{"start":{"line":5,"column":276},"end":{"line":5,"column":282}},"loc":{"start":{"line":5,"column":288},"end":{"line":5,"column":362}},"line":5},"6":{"name":"(anonymous_6)","decl":{"start":{"line":21,"column":0},"end":{"line":21,"column":1}},"loc":{"start":{"line":21,"column":12},"end":{"line":52,"column":1}},"line":21},"7":{"name":"(anonymous_7)","decl":{"start":{"line":22,"column":31},"end":{"line":22,"column":32}},"loc":{"start":{"line":22,"column":66},"end":{"line":47,"column":3}},"line":22},"8":{"name":"(anonymous_8)","decl":{"start":{"line":24,"column":32},"end":{"line":24,"column":33}},"loc":{"start":{"line":24,"column":41},"end":{"line":39,"column":7}},"line":24},"9":{"name":"(anonymous_9)","decl":{"start":{"line":24,"column":101},"end":{"line":24,"column":102}},"loc":{"start":{"line":24,"column":108},"end":{"line":31,"column":5}},"line":24},"10":{"name":"(anonymous_10)","decl":{"start":{"line":31,"column":14},"end":{"line":31,"column":15}},"loc":{"start":{"line":31,"column":22},"end":{"line":39,"column":5}},"line":31},"11":{"name":"(anonymous_11)","decl":{"start":{"line":41,"column":35},"end":{"line":41,"column":36}},"loc":{"start":{"line":41,"column":54},"end":{"line":45,"column":5}},"line":41},"12":{"name":"sendWebPush","decl":{"start":{"line":49,"column":18},"end":{"line":49,"column":29}},"loc":{"start":{"line":49,"column":44},"end":{"line":51,"column":3}},"line":49}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":176},"end":{"line":3,"column":263}},"type":"if","locations":[{"start":{"line":3,"column":176},"end":{"line":3,"column":263}},{"start":{"line":3,"column":176},"end":{"line":3,"column":263}}],"line":3}},"s":{"0":14,"1":14,"2":12,"3":2,"4":2,"5":12,"6":6,"7":6,"8":1,"9":8,"10":8,"11":8,"12":8,"13":14,"14":0,"15":8,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":8,"27":8,"28":14,"29":8,"30":4,"31":6,"32":6,"33":6,"34":6,"35":1,"36":8,"37":1},"f":{"0":14,"1":1,"2":8,"3":8,"4":14,"5":0,"6":1,"7":8,"8":14,"9":8,"10":4,"11":6,"12":8},"b":{"0":[6,6]},"inputSourceMap":{"version":3,"sources":["sendWeb.js"],"names":["webPush","require","is","unless","assoc","WEB_METHOD","stringify","String","JSON","sendWebPush","regIds","data","settings","payload","promises","map","regId","sendNotification","web","then","success","failure","message","error","catch","err","errorMsg","results","Promise","all","reduced","reduce","acc","current","module","exports"],"mappings":";;;;;;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;iBAC8BA,OAAO,CAAC,OAAD,C;MAA7BC,E,YAAAA,E;MAAIC,M,YAAAA,M;MAAQC,K,YAAAA,K;;kBACGH,OAAO,CAAC,aAAD,C;MAAtBI,U,aAAAA,U;;AAER,MAAMC,SAAS,GAAGH,MAAM,CAACD,EAAE,CAACK,MAAD,CAAH,EAAaC,IAAI,CAACF,SAAlB,CAAxB;;AAEA,MAAMG,WAAW;AAAA;AAAA;AAAA,+BAAG,WAAOC,MAAP,EAAeC,IAAf,EAAqBC,QAArB,EAAkC;AACpD,UAAMC,OAAO,GAAGP,SAAS,CAACK,IAAD,CAAzB;AACA,UAAMG,QAAQ,GAAGJ,MAAM,CAACK,GAAP,CAAWC,KAAK,IAC/BhB,OAAO,CACJiB,gBADH,CACoBD,KADpB,EAC2BH,OAD3B,EACoCD,QAAQ,CAACM,GAD7C,EAEGC,IAFH,CAEQ,OAAO;AACXC,MAAAA,OAAO,EAAE,CADE;AAEXC,MAAAA,OAAO,EAAE,CAFE;AAGXC,MAAAA,OAAO,EAAE,CACP;AACEN,QAAAA,KADF;AAEEO,QAAAA,KAAK,EAAE;AAFT,OADO;AAHE,KAAP,CAFR,EAYGC,KAZH,CAYSC,GAAG,KAAK;AACbL,MAAAA,OAAO,EAAE,CADI;AAEbC,MAAAA,OAAO,EAAE,CAFI;AAGbC,MAAAA,OAAO,EAAE,CACP;AACEN,QAAAA,KADF;AAEEO,QAAAA,KAAK,EAAEE,GAFT;AAGEC,QAAAA,QAAQ,EAAED,GAAG,CAACH;AAHhB,OADO;AAHI,KAAL,CAZZ,CADe,CAAjB;AA0BA,UAAMK,OAAO,SAASC,OAAO,CAACC,GAAR,CAAYf,QAAZ,CAAtB;AAEA,UAAMgB,OAAO,GAAGH,OAAO,CAACI,MAAR,CAAe,CAACC,GAAD,EAAMC,OAAN,MAAmB;AAChDb,MAAAA,OAAO,EAAEY,GAAG,CAACZ,OAAJ,GAAca,OAAO,CAACb,OADiB;AAEhDC,MAAAA,OAAO,EAAEW,GAAG,CAACX,OAAJ,GAAcY,OAAO,CAACZ,OAFiB;AAGhDC,MAAAA,OAAO,EAAE,CAAC,GAAGU,GAAG,CAACV,OAAR,EAAiB,GAAGW,OAAO,CAACX,OAA5B;AAHuC,KAAnB,CAAf,CAAhB;AAKA,WAAOlB,KAAK,CAAC,QAAD,EAAWC,UAAX,EAAuByB,OAAvB,CAAZ;AACD,GApCgB;;AAAA,kBAAXrB,WAAW;AAAA;AAAA;AAAA,GAAjB;;AAsCAyB,MAAM,CAACC,OAAP,GAAiB1B,WAAjB","sourceRoot":"/Users/alfriedl/Developer/Projects/node-pushnotifications/src","sourcesContent":["const webPush = require('web-push');\nconst { is, unless, assoc } = require('ramda');\nconst { WEB_METHOD } = require('./constants');\n\nconst stringify = unless(is(String), JSON.stringify);\n\nconst sendWebPush = async (regIds, data, settings) => {\n  const payload = stringify(data);\n  const promises = regIds.map(regId =>\n    webPush\n      .sendNotification(regId, payload, settings.web)\n      .then(() => ({\n        success: 1,\n        failure: 0,\n        message: [\n          {\n            regId,\n            error: null,\n          },\n        ],\n      }))\n      .catch(err => ({\n        success: 0,\n        failure: 1,\n        message: [\n          {\n            regId,\n            error: err,\n            errorMsg: err.message,\n          },\n        ],\n      }))\n  );\n\n  const results = await Promise.all(promises);\n\n  const reduced = results.reduce((acc, current) => ({\n    success: acc.success + current.success,\n    failure: acc.failure + current.failure,\n    message: [...acc.message, ...current.message],\n  }));\n  return assoc('method', WEB_METHOD, reduced);\n};\n\nmodule.exports = sendWebPush;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"acf0a2d4b065428489d7f4090d590ad40e033352","contentHash":"7d16f8691050be25a08ba1df18488fb91f2699b5127693cf8a28854f79f1ee8d"}}